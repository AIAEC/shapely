import pytest

from shapely.extension.model.stretch.stretch_v3 import Stretch
from shapely.ops import unary_union
from shapely.wkt import loads


@pytest.fixture
def stretch_001() -> Stretch:
    return Stretch.loads(
        '{"pivot": {"0": [92.31915327871684, -38.57981466401761], "1": [85.23110575345538, -48.28052531032034], "2": [88.94527514099784, -50.99436866627208], "3": [100.3226862140171, -35.42322974102079], "4": [100.07724563705044, -19.069095381862297], "5": [29.063786142848386, 67.56562128728115], "6": [22.838028905293953, 62.46244121804599], "7": [92.07031501737946, -21.9992866628117], "8": [-56.82559511282135, -84.5120309482116], "9": [-56.82559511282135, -75.46889094629766], "10": [-64.87559511282134, -75.46889094629766], "11": [-64.87559511282134, -88.19965593768666], "12": [-56.86552160072714, -95.10789094634957], "13": [3.063253666841149, -95.10789094634958], "14": [24.80852280472205, -93.55927089900766], "15": [56.7257477755937, -83.51050936479754], "16": [74.24192955054343, -71.11738570288767], "17": [85.18204293715145, -56.14473293438149], "18": [78.68224650895228, -51.39550706146604], "19": [68.51836248168101, -65.30581136470896], "20": [53.10557433998788, -76.21073298912333], "21": [23.293234811899897, -85.59679618753923], "22": [2.776970140774438, -87.05789094634959], "23": [-53.873679650910596, -87.05789094634959], "24": [-35.49956963233092, 116.59210905365087], "25": [-21.531423919931616, 116.59210905365086], "26": [2.9589083631809534, 86.71449129509254], "27": [9.184665600735372, 91.8176713643277], "28": [-17.721140361240273, 124.64210905365086], "29": [-39.40576071780106, 124.64210905365087], "30": [-64.87559511282146, 92.31157236118835], "31": [-64.87559511282142, 72.67481803511708], "32": [-56.82559511282142, 72.67481803511708], "33": [-56.82559511282142, 89.52158167573472], "34": [-56.825595112821375, -51.79689094627836], "35": [-56.825595112821375, -12.816892268426528], "36": [-64.87559511282137, -12.816892268426528], "37": [-64.87559511282137, -51.79689094627836], "38": [-64.8755951128214, 6.803250884145122], "39": [-56.825595112821404, 6.803250884145122], "40": [-56.825595112821404, 50.20281793866988], "41": [-64.8755951128214, 50.20281793866988], "68": [81.134529696606, -8.657890967293724], "74": [-18.925595152037992, -87.05789094634957], "79": [45.87440484796201, -78.48738134765505], "80": [45.87440484796201, -8.657890967293724], "81": [13.474404847962006, -8.657890967293724], "83": [-48.26184825220687, 100.39210905365088], "85": [-18.92559515203797, 100.39210905365088], "86": [-8.252474232827545, 100.39210905365088], "90": [13.474404847962006, 35.84210905402929], "92": [44.65840245220607, 35.84210905402929], "102": [-18.925595152038, -36.007890943994425], "103": [-56.82559511282136, -36.00789094399437], "104": [-18.925595152037992, 31.09210905600539], "105": [-56.82559511282139, 31.09210905600539], "106": [13.474404847962006, 31.09210905600539]}, "pivot_cargo": {"0": {}, "1": {}, "2": {}, "3": {}, "4": {}, "5": {}, "6": {}, "7": {}, "8": {}, "9": {}, "10": {}, "11": {}, "12": {}, "13": {}, "14": {}, "15": {}, "16": {}, "17": {}, "18": {}, "19": {}, "20": {}, "21": {}, "22": {}, "23": {}, "24": {}, "25": {}, "26": {}, "27": {}, "28": {}, "29": {}, "30": {}, "31": {}, "32": {}, "33": {}, "34": {}, "35": {}, "36": {}, "37": {}, "38": {}, "39": {}, "40": {}, "41": {}, "68": {}, "74": {}, "79": {}, "80": {}, "81": {}, "83": {}, "85": {}, "86": {}, "90": {}, "92": {}, "102": {}, "103": {}, "104": {}, "105": {}, "106": {}}, "edge_cargo": {"(0,1)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(1,2)": {"width": 0, "is_fixed": true, "is_starting": false}, "(2,3)": {"width": 0, "is_fixed": true, "is_starting": false}, "(3,4)": {"width": 0, "is_fixed": true, "is_starting": false}, "(4,5)": {"width": 0, "is_fixed": true, "is_starting": false}, "(5,6)": {"width": 0, "is_fixed": true, "is_starting": false}, "(7,0)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(8,9)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(9,10)": {"width": 0, "is_fixed": true, "is_starting": false}, "(10,11)": {"width": 0, "is_fixed": true, "is_starting": false}, "(11,12)": {"width": 0, "is_fixed": true, "is_starting": false}, "(12,13)": {"width": 0, "is_fixed": true, "is_starting": false}, "(13,14)": {"width": 0, "is_fixed": true, "is_starting": false}, "(14,15)": {"width": 0, "is_fixed": true, "is_starting": false}, "(15,16)": {"width": 0, "is_fixed": true, "is_starting": false}, "(16,17)": {"width": 0, "is_fixed": true, "is_starting": false}, "(17,18)": {"width": 0, "is_fixed": true, "is_starting": false}, "(18,19)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(23,8)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(26,27)": {"width": 0, "is_fixed": true, "is_starting": false}, "(27,28)": {"width": 0, "is_fixed": true, "is_starting": false}, "(28,29)": {"width": 0, "is_fixed": true, "is_starting": false}, "(29,30)": {"width": 0, "is_fixed": true, "is_starting": false}, "(30,31)": {"width": 0, "is_fixed": true, "is_starting": false}, "(31,32)": {"width": 0, "is_fixed": true, "is_starting": false}, "(35,36)": {"width": 0, "is_fixed": true, "is_starting": false}, "(36,37)": {"width": 0, "is_fixed": true, "is_starting": false}, "(37,34)": {"width": 0, "is_fixed": true, "is_starting": false}, "(38,39)": {"width": 0, "is_fixed": true, "is_starting": false}, "(40,41)": {"width": 0, "is_fixed": true, "is_starting": false}, "(41,38)": {"width": 0, "is_fixed": true, "is_starting": false}, "(10,9)": {"width": 0, "is_fixed": true, "is_starting": false}, "(9,8)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(8,23)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(19,18)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(18,17)": {"width": 0, "is_fixed": true, "is_starting": false}, "(2,1)": {"width": 0, "is_fixed": true, "is_starting": false}, "(1,0)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(0,7)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(6,5)": {"width": 0, "is_fixed": true, "is_starting": false}, "(27,26)": {"width": 0, "is_fixed": true, "is_starting": false}, "(32,31)": {"width": 0, "is_fixed": true, "is_starting": false}, "(31,41)": {"width": 0, "is_fixed": false, "is_starting": false}, "(41,40)": {"width": 0, "is_fixed": true, "is_starting": false}, "(39,38)": {"width": 0, "is_fixed": true, "is_starting": false}, "(38,36)": {"width": 0, "is_fixed": false, "is_starting": false}, "(36,35)": {"width": 0, "is_fixed": true, "is_starting": false}, "(34,37)": {"width": 0, "is_fixed": true, "is_starting": false}, "(37,10)": {"width": 0, "is_fixed": false, "is_starting": false}, "(68,7)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(7,68)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(21,22)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(22,21)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(24,25)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(25,24)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(17,2)": {"width": 0, "is_fixed": false, "is_starting": false}, "(22,74)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(74,22)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(20,79)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(79,21)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(21,79)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(79,20)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(79,80)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(80,79)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(33,83)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(83,24)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(24,83)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(83,33)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(25,86)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(86,26)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(26,86)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(86,25)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(85,86)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(86,85)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(92,68)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(68,92)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(19,20)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(20,19)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(74,23)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(23,74)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(32,33)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(33,32)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(6,92)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(92,6)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(68,80)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(80,68)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(83,85)": {"width": 2.75, "is_fixed": false, "is_starting": true}, "(85,83)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(80,81)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(81,80)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(92,90)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(90,92)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(5,27)": {"width": 0, "is_fixed": false, "is_starting": false}, "(102,103)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(103,102)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(104,105)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(105,104)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(81,106)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(106,90)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(90,106)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(106,81)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(106,104)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(104,106)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(34,103)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(103,34)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(103,35)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(35,103)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(39,105)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(105,39)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(105,40)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(40,105)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(74,102)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(102,74)": {"width": 2.75, "is_fixed": false, "is_starting": true}, "(104,85)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(85,104)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(104,102)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(102,104)": {"width": 2.75, "is_fixed": false, "is_starting": false}}, "closure": {"1": {"exterior": ["10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "79", "21", "22", "74", "23", "8", "9", "10"], "interiors": []}, "2": {"exterior": ["24", "25", "86", "26", "27", "28", "29", "30", "31", "32", "33", "83", "24"], "interiors": []}, "3": {"exterior": ["34", "103", "35", "36", "37", "34"], "interiors": []}, "4": {"exterior": ["38", "39", "105", "40", "41", "38"], "interiors": []}, "6": {"exterior": ["0", "1", "2", "3", "4", "5", "6", "92", "68", "7", "0"], "interiors": []}, "114": {"exterior": ["0", "7", "68", "80", "79", "20", "19", "18", "17", "2", "1", "0"], "interiors": []}, "125": {"exterior": ["24", "83", "85", "86", "25", "24"], "interiors": []}, "140": {"exterior": ["80", "68", "92", "90", "106", "81", "80"], "interiors": []}, "164": {"exterior": ["10", "9", "8", "23", "74", "102", "103", "34", "37", "10"], "interiors": []}, "167": {"exterior": ["104", "85", "83", "33", "32", "31", "41", "40", "105", "104"], "interiors": []}, "169": {"exterior": ["74", "22", "21", "79", "80", "81", "106", "104", "102", "74"], "interiors": []}, "170": {"exterior": ["104", "106", "90", "92", "6", "5", "27", "26", "86", "85", "104"], "interiors": []}, "172": {"exterior": ["102", "104", "105", "39", "38", "36", "35", "103", "102"], "interiors": []}}, "closure_cargo": {"1": {"angle": 0, "region_type": "surrounding", "clamp": false, "seen0baeced2-a353-49": true}, "2": {"angle": 0, "region_type": "surrounding", "clamp": false, "seen0baeced2-a353-49": true}, "3": {"angle": 0, "region_type": "surrounding", "clamp": false, "seen0baeced2-a353-49": true}, "4": {"angle": 0, "region_type": "surrounding", "clamp": false, "seen0baeced2-a353-49": true}, "6": {"angle": 0, "region_type": "surrounding", "clamp": false, "seen0baeced2-a353-49": true}, "114": {"angle": 90, "region_type": "building", "clamp": false, "seen0baeced2-a353-49": true}, "125": {"angle": 0.0, "region_type": "core", "clamp": false, "seen0baeced2-a353-49": true}, "140": {"angle": 90, "region_type": "building", "clamp": false, "seen0baeced2-a353-49": true}, "164": {"angle": 90, "region_type": "building", "clamp": false, "seen0baeced2-a353-49": false}, "167": {"angle": 90, "region_type": "building", "clamp": false, "seen0baeced2-a353-49": false}, "169": {"angle": 90, "region_type": "core", "clamp": false, "seen0baeced2-a353-49": false}, "170": {"angle": 90, "region_type": "building", "clamp": false, "seen0baeced2-a353-49": false}, "172": {"angle": 90, "region_type": "building", "clamp": false, "seen0baeced2-a353-49": false}}}')


@pytest.fixture
def stretch_002() -> Stretch:
    return Stretch.loads(
        '{"pivot": {"0": [-107.35919009521606, 4.3175316568887485], "1": [-108.75519247616947, 27.102819230527743], "2": [-113.34658312236718, 26.82151524191516], "10": [116.51622322275124, 8.18781476413892], "11": [115.79331859138435, 16.20528998355484], "12": [87.41960546281186, 13.646942365757337], "13": [89.25868902944137, -6.749581037828033], "14": [94.53727500913122, -6.2736293018064515], "15": [95.73752621107327, -19.58197122503787], "16": [96.02617266215385, -23.39413989135904], "17": [-110.85922990809489, -41.999835168942816], "18": [-112.4480894068256, -24.37601587373924], "19": [-108.48314483113373, -8.386709249104658], "20": [-17.542348061960894, 31.59045897081526], "21": [144.0640604486713, 31.58116830738623], "22": [144.06432490013762, 36.181168299785305], "23": [-51.655086762783576, 36.19242010097964], "24": [-51.6555495528497, 28.14242011428238], "25": [-17.542546400560653, 28.140458976517085], "26": [-97.42506135593212, 28.97929035766782], "27": [-97.42502917683319, 30.779563813321545], "28": [-100.67511129772899, 30.779286107349606], "29": [-100.67502410768111, 31.229171221275124], "30": [-102.12503258328277, 31.2292903787241], "31": [-102.12511984054498, 27.82929038081801], "32": [-113.40832719704719, 27.82929038347072], "33": [146.82488047567938, 10.920628785888823], "34": [146.82487281109692, 36.181009597406046], "35": [-51.65537209037815, 31.22929037836201], "36": [-56.73512112358688, 31.22929037834774], "37": [-56.73512112360197, 30.77928902193878], "38": [-59.58502599795051, 30.779211709870026], "39": [-59.58891397548879, 27.829289879367195], "40": [-65.80511967539181, 27.829289879367195], "41": [-65.80508645134128, 28.976563020899164], "42": [-85.05512112368118, 28.979204220099575], "43": [-85.05512112368118, 28.37919456192583], "44": [-91.5052005181231, 28.378833679165098], "45": [-91.5050496091755, 28.979290356267143], "59": [103.68632421774541, 15.113649278155023], "60": [102.2051447298799, 31.5835747533993], "69": [-108.70346897456655, -9.275203455998485], "73": [-19.580073905923882, -1.2601250088555278], "75": [-22.224162408187617, 28.140728120043207], "77": [-35.71495719303, -2.711173357967965], "78": [-38.489626012353284, 28.14166321258847], "79": [59.72122749481073, -26.659129776876036], "81": [56.81913079705263, 5.61063679865935], "82": [54.48307611130879, 31.58631826884376], "83": [-75.84020971921065, -6.319732552341786], "84": [-72.9381130219703, -38.589499124913324], "85": [57.06756933154884, 2.848132874253957], "87": [88.14143345823597, 5.64144339378107], "88": [98.4796769562001, -19.374343454736174], "89": [96.23140566400028, 5.560313620101062], "90": [94.45002658598372, 5.39969358070098], "91": [95.49487474183293, -6.188289921728826], "92": [-111.97163789125746, 4.379918504210944], "93": [-113.03380188344988, -7.625891696385357], "94": [-117.09891779592085, -24.01915609964698], "95": [-114.71793106163467, -50.42934528717445], "96": [99.37323557552628, -31.175618545495958], "97": [105.74121118855447, 15.298930462989397], "98": [106.26445142249725, 9.495861250682736], "99": [100.96435844841034, 9.017972432503845], "100": [101.16402284579465, 6.803566425298105], "101": [87.54543191567852, 12.251452657049589], "102": [94.03718084554615, 12.23667842798737], "103": [94.90677708071307, 14.322031578998507]}, "pivot_cargo": {"0": {}, "1": {}, "2": {}, "10": {}, "11": {}, "12": {}, "13": {}, "14": {}, "15": {}, "16": {}, "17": {}, "18": {}, "19": {}, "20": {}, "21": {}, "22": {}, "23": {}, "24": {}, "25": {}, "26": {}, "27": {}, "28": {}, "29": {}, "30": {}, "31": {}, "32": {}, "33": {}, "34": {}, "35": {}, "36": {}, "37": {}, "38": {}, "39": {}, "40": {}, "41": {}, "42": {}, "43": {}, "44": {}, "45": {}, "59": {}, "60": {}, "69": {}, "73": {}, "75": {}, "77": {}, "78": {}, "79": {}, "81": {}, "82": {}, "83": {}, "84": {}, "85": {}, "87": {}, "88": {}, "89": {}, "90": {}, "91": {}, "92": {}, "93": {}, "94": {}, "95": {}, "96": {}, "97": {}, "98": {}, "99": {}, "100": {}, "101": {}, "102": {}, "103": {}}, "edge_cargo": {"(21,22)": {"width": 0, "is_fixed": true, "is_starting": false}, "(22,23)": {"width": 0, "is_fixed": true, "is_starting": false}, "(25,20)": {"width": 4.2064166252698225, "is_fixed": true, "is_starting": false}, "(23,35)": {"width": 0, "is_fixed": true, "is_starting": false}, "(35,24)": {"width": 0, "is_fixed": true, "is_starting": false}, "(26,27)": {"width": 0, "is_fixed": false, "is_starting": false}, "(27,28)": {"width": 0, "is_fixed": false, "is_starting": false}, "(28,29)": {"width": 0, "is_fixed": false, "is_starting": false}, "(29,30)": {"width": 0, "is_fixed": false, "is_starting": false}, "(30,31)": {"width": 0, "is_fixed": false, "is_starting": false}, "(31,32)": {"width": 0, "is_fixed": false, "is_starting": false}, "(32,2)": {"width": 0, "is_fixed": false, "is_starting": false}, "(2,1)": {"width": 0, "is_fixed": true, "is_starting": false}, "(1,0)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(18,17)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(16,15)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(15,14)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(14,13)": {"width": 4.973479230783974, "is_fixed": true, "is_starting": false}, "(11,10)": {"width": 0, "is_fixed": true, "is_starting": false}, "(10,33)": {"width": 0, "is_fixed": false, "is_starting": false}, "(33,34)": {"width": 0, "is_fixed": false, "is_starting": false}, "(34,22)": {"width": 0, "is_fixed": false, "is_starting": false}, "(22,21)": {"width": 0, "is_fixed": true, "is_starting": false}, "(20,25)": {"width": 1.2935833747301775, "is_fixed": true, "is_starting": false}, "(24,35)": {"width": 0, "is_fixed": true, "is_starting": false}, "(36,37)": {"width": 0, "is_fixed": false, "is_starting": false}, "(37,38)": {"width": 0, "is_fixed": false, "is_starting": false}, "(39,40)": {"width": 0, "is_fixed": false, "is_starting": false}, "(40,41)": {"width": 0, "is_fixed": false, "is_starting": false}, "(41,42)": {"width": 0, "is_fixed": false, "is_starting": false}, "(42,43)": {"width": 0, "is_fixed": false, "is_starting": false}, "(43,44)": {"width": 0, "is_fixed": false, "is_starting": false}, "(44,45)": {"width": 0, "is_fixed": false, "is_starting": false}, "(45,26)": {"width": 0, "is_fixed": false, "is_starting": false}, "(60,21)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(21,60)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(59,60)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(60,59)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(35,36)": {"width": 0, "is_fixed": false, "is_starting": false}, "(38,39)": {"width": 0, "is_fixed": false, "is_starting": false}, "(19,69)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(69,18)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(75,25)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(25,75)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(73,77)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(77,73)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(24,78)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(78,75)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(75,78)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(78,24)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(0,19)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(75,73)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(73,75)": {"width": 2.75, "is_fixed": false, "is_starting": true}, "(78,77)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(77,78)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(81,73)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(73,81)": {"width": 2.75, "is_fixed": false, "is_starting": true}, "(20,82)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(82,20)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(81,82)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(82,81)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(77,83)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(83,77)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(84,79)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(83,84)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(84,83)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(85,81)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(81,85)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(13,87)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(79,16)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(17,84)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(82,60)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(60,82)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(69,83)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(83,69)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(79,85)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(85,79)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(85,87)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(87,85)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(88,89)": {"width": 0, "is_fixed": true, "is_starting": false}, "(89,90)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(90,91)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(91,14)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(14,15)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(15,16)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(16,79)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(79,84)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(84,17)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(17,18)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(18,69)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(69,19)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(19,0)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(0,1)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(1,2)": {"width": 0, "is_fixed": true, "is_starting": false}, "(2,92)": {"width": 0, "is_fixed": true, "is_starting": false}, "(92,93)": {"width": 0, "is_fixed": true, "is_starting": false}, "(93,94)": {"width": 0, "is_fixed": true, "is_starting": false}, "(94,95)": {"width": 0, "is_fixed": true, "is_starting": false}, "(95,96)": {"width": 0, "is_fixed": true, "is_starting": false}, "(96,88)": {"width": 0, "is_fixed": true, "is_starting": false}, "(59,97)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(97,11)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(11,97)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(97,98)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(98,99)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(99,100)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(100,10)": {"width": 0, "is_fixed": true, "is_starting": false}, "(10,11)": {"width": 0, "is_fixed": true, "is_starting": false}, "(87,101)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(101,12)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(12,103)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(103,59)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(12,101)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(101,102)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(102,103)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(103,12)": {"width": 2.75, "is_fixed": true, "is_starting": false}}, "closure": {"1": {"exterior": ["20", "82", "60", "21", "22", "23", "35", "24", "78", "75", "25", "20"], "interiors": []}, "27": {"exterior": ["10", "33", "34", "22", "21", "60", "59", "97", "11", "10"], "interiors": []}, "87": {"exterior": ["73", "75", "78", "77", "73"], "interiors": []}, "88": {"exterior": ["0", "19", "69", "83", "77", "78", "24", "35", "36", "37", "38", "39", "40", "41", "42", "43", "44", "45", "26", "27", "28", "29", "30", "31", "32", "2", "1", "0"], "interiors": []}, "96": {"exterior": ["20", "25", "75", "73", "81", "82", "20"], "interiors": []}, "99": {"exterior": ["73", "77", "83", "84", "79", "85", "81", "73"], "interiors": []}, "100": {"exterior": ["17", "84", "83", "69", "18", "17"], "interiors": []}, "105": {"exterior": ["12", "103", "59", "60", "82", "81", "85", "87", "101", "12"], "interiors": []}, "106": {"exterior": ["13", "87", "85", "79", "16", "15", "14", "13"], "interiors": []}, "107": {"exterior": ["0", "1", "2", "92", "93", "94", "95", "96", "88", "89", "90", "91", "14", "15", "16", "79", "84", "17", "18", "69", "19", "0"], "interiors": []}, "108": {"exterior": ["10", "11", "97", "98", "99", "100", "10"], "interiors": []}, "109": {"exterior": ["101", "102", "103", "12", "101"], "interiors": []}}, "closure_cargo": {"1": {"angle": 0, "region_type": "surrounding", "clamp": false, "seene8338653-5cf2-40": true}, "27": {"angle": 5.13892094950298, "region_type": "building", "clamp": false, "seene8338653-5cf2-40": true}, "87": {"angle": -84.86107905049698, "region_type": "core", "clamp": true, "seene8338653-5cf2-40": false}, "88": {"angle": 5.13892094950298, "region_type": "building", "clamp": false, "seene8338653-5cf2-40": false}, "96": {"angle": 5.13892094950298, "region_type": "building", "clamp": false, "seene8338653-5cf2-40": false}, "99": {"angle": 5.13892094950298, "region_type": "core", "clamp": false, "seene8338653-5cf2-40": false}, "100": {"angle": 5.13892094950298, "region_type": "building", "clamp": false, "seene8338653-5cf2-40": false}, "105": {"angle": 5.13892094950298, "region_type": "building", "clamp": false, "seene8338653-5cf2-40": false}, "106": {"angle": 5.13892094950298, "region_type": "building", "clamp": false, "seene8338653-5cf2-40": false}, "107": {"angle": 0, "region_type": "surrounding", "clamp": false, "seene8338653-5cf2-40": true}, "108": {"angle": 0, "region_type": "surrounding", "clamp": false, "seene8338653-5cf2-40": true}, "109": {"angle": 0, "region_type": "surrounding", "clamp": false, "seene8338653-5cf2-40": true}}}')


def test_difference_without_lefting_0_width_convex_part(stretch_001):
    stretch = stretch_001

    closure = stretch.closures[9]
    removing_part = loads(
        'MULTIPOLYGON (((-18.925595152038 -36.007890943994404, -56.82559511282136 -36.007890943994404, -56.82559511282137 -20.507890943994425, -18.925595152038 -20.507890943994425, -18.925595152038 -36.007890943994404)), ((-56.82559511282139 31.09210905600539, -56.8255951128214 43.94210905600539, -18.92559515203799 43.94210905600539, -18.925595152037992 31.09210905600539, -56.82559511282139 31.09210905600539)), ((16.706980757494215 27.88884595767101, -2.725595152038009 27.88884595767101, -2.7255951520380113 43.492109648140286, 19.560036470647162 43.492108991169516, 30.82140179267344 52.72291785038479, 37.31413428012374 44.80194000385802, 16.706980757494215 27.88884595767101)))')

    new_closures = closure.difference(removing_part)
    assert len(new_closures) == 1

    new_closure = new_closures[0]
    assert new_closure.shape.almost_equals(loads(
        'POLYGON ((-56.8255951128214 43.94210955600539, -18.92559515203799 43.94210955600539, -18.92559515203797 100.39210905365088, -48.26184825220687 100.39210905365088, -56.82559511282142 89.52158167573472, -56.82559511282142 72.67481803511708, -64.87559511282142 72.67481803511708, -64.8755951128214 50.20281793866988, -56.825595112821404 50.20281793866988, -56.8255951128214 43.94210955600539))'))
    assert len(new_closure.pivots) == 9
    assert len(new_closure.edges) == 9


def test_difference_inheriting_old_lane_width(stretch_002):
    stretch = stretch_002

    closure = stretch.closure('27')
    removing_part = loads(
        'POLYGON ((103.6863242177454 15.113649278155021, 103.20633794373408 20.45084050100868, 105.35652524014532 19.554208303744474, 105.74021522889994 15.298840661171843, 103.6863242177454 15.113649278155021))')
    new_closures = closure.difference(removing_part)
    assert len(new_closures) == 1
    assert unary_union(
        [e.shape.ext.buffer().single_sided().rect(e.cargo['width'] or 0) for e in new_closures[0].edges]).almost_equals(
        loads(
            'MULTIPOLYGON (((105.49326033021994 18.037729720264593, 105.4942561902785 18.037819513101965, 115.54636359310776 18.944179033667353, 115.79331859138435 16.20528998355484, 105.74121118855447 15.298930462989397, 105.7402153284959 15.298840670152028, 105.49326033021994 18.037729720264593)), ((102.20493776786276 27.983574759348368, 102.2051447298799 31.5835747533993, 104.944090966895 31.829894689134953, 104.9662573787352 31.583416018553656, 144.0640604486713 31.58116830738623, 144.06385348665415 27.981168313335296, 105.29001559742686 27.98339739992289, 105.9452841706257 20.69716054931207, 103.2063379336106 20.450840613576418, 102.52890294857158 27.983556134768538, 102.20493776786276 27.983574759348368)))'))
