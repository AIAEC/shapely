from _pytest.fixtures import fixture

from shapely.extension.model.stretch.stretch_v3 import Stretch
from shapely.wkt import loads


@fixture
def polys_case_0():
    polys = [
        loads('POLYGON ((-62.96918787845088 43.697584882620575, -62.96829176334033 64.56894869051443, -52.01918792000006 64.56910691084455, -52.01918792000006 64.39334787234446, -51.71918792000001 64.39334786996028, -51.71918792000001 62.79933257, -51.41918791704728 62.79933256997882, -51.41918791742703 57.41929386373487, -51.21918791694353 57.41929386373487, -51.21918791694352 57.297584882835274, -45.969187917287194 57.29758488226263, -45.969187917158656 58.47608597239094, -41.21918791872327 63.22608597083889, -41.122689009562414 63.322584879999994, -37.45944538685685 63.322584879999994, -34.819187910000004 63.303171206608106, -34.819187910000004 63.297584879999995, -34.059445361783396 63.297584859889156, -31.419187919999995 63.278171186755166, -31.419187919999995 58.99758488002682, -27.869187919887782 58.99758489907683, -27.844187919999992 63.24758488, -27.834187919824544 64.94758490982632, -10.659187917938763 64.947585268172, -10.65626733776575 64.24758502221506, -10.64731020261978 64.24759345345888, 0.7983381556236527 64.25836993538013, 1.280812185622736 63.77608596553171, 3.2206863325824653 61.83697598980128, 5.5808121422284875 59.47777990038689, 5.580812238169007 54.69758488000001, -3.06918781 54.69758488000001, -3.06918781 57.04758488000001, -4.81918782 57.04758488000001, -4.81918782 58.397584880000004, -10.6591879176675 58.397584880000004, -10.654187917667498 57.84111951197656, -10.6591879176675 57.74758488262062, -10.659187917667506 3.2975848616761962, -10.659187917667502 -20.1024151383238, -26.859187917667512 -20.1024151383238, -26.85918791766751 -10.951416635280653, -27.56918804345904 -10.951416688867138, -27.5691884924438 -5.002543039615027, -31.01918823 -5.0025433, -34.069188229999995 -5.002543530195431, -34.069188229999995 -4.152409219999998, -38.219192079284944 -4.1524089937976925, -38.21918822999999 -2.4505433, -39.46918834080686 -2.4505432898387203, -39.46918833 1.8495833599999998, -44.66918844000001 1.8495833599999998, -44.66918844002172 1.6495833610761594, -41.2701378329677 1.64958336070697, -41.27013783290289 -7.150150546811459, -50.61918822901776 -7.100543298784827, -50.61918822864985 -4.322338539727757, -50.61918822817682 -0.7504173500066216, -50.669188229532885 -0.75041735, -50.66918845841472 1.699583360000002, -50.894188251362344 1.6995833600000003, -50.89418771730473 1.8245833600000003, -52.36918858724496 1.8245833600000003, -52.369188053187344 1.79958336, -52.969186859694396 1.79958336, -52.96918823298542 -0.50041664, -53.06918823000001 -0.5004166399999974, -53.06918823000001 -0.60041664, -55.669188240000004 -0.60041664, -55.669188245535686 -0.6504163355356793, -55.66918830089284 -1.1504164695652175, -56.58909078825046 -1.1504164675654296, -65.06918787845088 -1.150416449130436, -65.0691878784509 43.697584882620575, -62.96918787845088 43.697584882620575))'),
        loads('POLYGON ((-62.969187878450875 91.79758488262061, -39.41918787845097 124.39758488262076, -17.399068624318005 124.39758488262076, 17.983653382097053 81.2257854082553, 13.399654816119076 77.46833563520724, 9.400654909999998 77.46833563520724, 9.400654909999998 71.29758487999999, 7.455812179999995 71.29758487999999, 7.455812180000001 69.09157115999999, 7.332068534870266 69.09157115999999, 7.332068534870271 68.96782735984328, 11.42668763076937 64.87321339370783, 11.430812184593492 63.497584877738085, 11.430812185209192 59.04758487840264, 7.655812210893546 59.04758468196311, 6.011176979101415 59.04758459638129, 1.280812185622736 63.776085965531706, 1.2808121855534513 65.77258491000606, 1.1058121900000004 65.77258490999999, 1.1058121900000004 64.2586594330363, -10.656267337756512 64.24758502, -10.659187917938768 64.94758526817195, -27.844187919999992 64.94758490961765, -27.868452628600895 63.29758469600996, -31.41918792 63.29758479000001, -34.81918790999999 63.297584880000024, -34.81918790999999 63.347584880000014, -34.96918792 63.34758488000001, -39.244187929999995 63.347584880000014, -39.244187929999995 65.97258484, -41.21918791798751 65.97258488004685, -41.219187918723286 63.22608597083888, -45.96918791715867 58.476085972390926, -47.147689007155286 57.29758488239119, -51.219187916943504 57.29758488283528, -51.21918791694352 57.419293863734886, -51.419187917427 57.419293863734886, -51.41918791704725 62.799332569978816, -51.719187919999996 62.79933256999999, -51.719187919999996 64.39334786999999, -52.01918792 64.39334786999999, -52.01918791999999 64.86908378999999, -53.61918792000001 64.86908378999999, -53.61918792000001 64.56908379, -62.968291763340325 64.56894869051446, -62.969187878450875 91.79758488262061))'),
        loads('POLYGON ((-32.744440637442885 63.28791569979741, -32.744405089512334 63.29758482507926, -31.41918792 63.297584789999995, -27.868452628600895 63.29758469600995, -27.844187920000003 64.94758490961745, -27.834187919824544 64.94758490982657, -27.84418792 63.24758488000003, -27.86918792000001 58.99758488000061, -31.419187920000002 58.997584880000005, -31.419187920000002 63.278171186755166, -32.744440637442885 63.28791569979741))'),
    ]
    return polys


def test_add_closure_case_0(polys_case_0):
    polys = polys_case_0
    stretch = Stretch()

    for poly in polys:
        stretch.add_closure(poly, dist_tol_to_edge=0.01, dist_tol_to_pivot=0.01)

    assert len(stretch.closures) == 3
    for closure in stretch.closures:
        for edge in closure.edges:
            assert edge.closure == closure
