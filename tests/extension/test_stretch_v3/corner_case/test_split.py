import pytest

from shapely.extension.model.stretch.stretch_v3 import Stretch
from shapely.wkt import loads


@pytest.fixture
def stretch_case0() -> Stretch:
    json_str = '{"pivot": {"0": [198.94880364903648, -43.205590197861916], "1": [196.86548450431775, -37.77788406986883], "2": [198.95140896572138, -37.77788406986883], "3": [198.95140896572138, 20.903957797711342], "4": [122.75137806015061, 20.903957797711342], "5": [122.75137806015061, 59.61924704999515], "6": [88.58193615218005, 69.58029003574609], "7": [70.1395328902342, 70.55395780186495], "8": [-97.24859261027132, 70.55395711919181], "9": [-181.41369182587104, 67.903950062969], "10": [-206.74859359656992, 60.74827907859783], "11": [-206.74859266392338, 51.00046268434173], "12": [-198.6985926639234, 51.00046345454521], "13": [-198.69859301377306, 54.65701639439406], "14": [-195.9365333860862, 55.437141382185935], "15": [-196.87427624899314, 58.75725257355698], "16": [-180.70567984945737, 63.32396284393671], "17": [-160.75185815641058, 63.95222525648472], "18": [-160.64328588542975, 60.50393407649797], "19": [-97.12189356673, 62.50395711970841], "20": [69.9271806649952, 62.50395780099879], "21": [87.22525281714282, 61.59070506320086], "22": [118.15137806015062, 52.57515064595245], "23": [118.15137806015062, 36.339958898731055], "24": [114.70137806015062, 36.339958898731055], "25": [114.70137806015062, 12.853957797711342], "26": [190.90140896572137, 12.853957797711338], "27": [190.90140896572137, -37.671805252699585], "28": [190.69605324584532, -37.7506270408743], "29": [193.58069556177898, -45.266033796940526], "30": [-214.0534798549007, 37.15322502172427], "31": [-206.74873163480848, 37.154005835362796], "32": [-206.74959210933338, 45.2040057893742], "33": [-217.28569200346953, 45.20287957252916], "34": [-235.14859561942822, 28.103957848986127], "35": [-235.14859253839165, -4.096042406857038], "36": [-225.4247969677064, -33.39604123342747], "37": [-209.5252148473475, -53.74258001327212], "38": [-169.63605071658026, -66.24604269114805], "39": [-147.28661973521434, -66.24604055299395], "40": [-120.73683599393834, -39.69626188496757], "41": [-114.24858830112599, -28.07889647763149], "42": [-114.24859485690388, 16.953957975117405], "43": [23.851374294463437, 17.055199587461942], "44": [23.851374294463426, -29.54940223209325], "45": [48.86703103505623, -49.896042202258684], "46": [110.17989051976082, -49.896042202243905], "47": [111.1642512145192, -52.46061354446711], "48": [118.67965797061336, -49.57597122860645], "49": [115.71267546498024, -41.84604220224258], "50": [51.72744485162612, -41.84604220225795], "51": [31.901374294463427, -25.72038442589826], "52": [31.901374294463427, 25.11110323626781], "53": [-122.29859602794536, 24.998058651858955], "54": [-122.29858860619933, -25.983291769147094], "55": [-127.21975701439784, -34.79476357723085], "56": [-150.6210387807825, -58.19604087199539], "57": [-168.40395000269484, -58.19604257327383], "58": [-192.18510764506738, -50.741716981354564], "59": [-193.2170205469389, -54.03377648308765], "60": [-206.78257316067373, -49.781584578231346], "61": [-216.43930580550213, -37.42395883969574], "62": [-213.72087120107545, -35.29966759284297], "63": [-218.22356659275957, -29.537612608662315], "64": [-227.09859266286676, -2.795148562639799], "65": [-227.09859529047299, 24.666038587590954], "66": [116.71957145785933, -66.93398206558612], "67": [121.6242213188176, -64.36362481329365], "68": [124.47503387072868, -71.79089432017207], "69": [155.23685407285973, -59.9835695607411], "70": [157.24356177071303, -65.21167860828763], "71": [164.43221176292212, -62.45245550372266], "72": [167.1556007815921, -69.54774635419835], "73": [192.08247779650395, -59.98005074257287], "74": [189.35908877743213, -52.88475989224713], "75": [195.05399332806633, -50.69888184401236], "76": [193.04728563015442, -45.47077279649784]}, "pivot_cargo": {"0": {}, "1": {}, "2": {}, "3": {}, "4": {}, "5": {}, "6": {}, "7": {}, "8": {}, "9": {}, "10": {}, "11": {}, "12": {}, "13": {}, "14": {}, "15": {}, "16": {}, "17": {}, "18": {}, "19": {}, "20": {}, "21": {}, "22": {}, "23": {}, "24": {}, "25": {}, "26": {}, "27": {}, "28": {}, "29": {}, "30": {}, "31": {}, "32": {}, "33": {}, "34": {}, "35": {}, "36": {}, "37": {}, "38": {}, "39": {}, "40": {}, "41": {}, "42": {}, "43": {}, "44": {}, "45": {}, "46": {}, "47": {}, "48": {}, "49": {}, "50": {}, "51": {}, "52": {}, "53": {}, "54": {}, "55": {}, "56": {}, "57": {}, "58": {}, "59": {}, "60": {}, "61": {}, "62": {}, "63": {}, "64": {}, "65": {}, "66": {}, "67": {}, "68": {}, "69": {}, "70": {}, "71": {}, "72": {}, "73": {}, "74": {}, "75": {}, "76": {}}, "edge_cargo": {"(0,1)": {"width": 0, "is_fixed": true, "is_starting": false}, "(1,2)": {"width": 0, "is_fixed": true, "is_starting": false}, "(2,3)": {"width": 0, "is_fixed": true, "is_starting": false}, "(3,4)": {"width": 0, "is_fixed": true, "is_starting": false}, "(4,5)": {"width": 0, "is_fixed": true, "is_starting": false}, "(5,6)": {"width": 0, "is_fixed": true, "is_starting": false}, "(6,7)": {"width": 0, "is_fixed": true, "is_starting": false}, "(7,8)": {"width": 0, "is_fixed": true, "is_starting": false}, "(8,9)": {"width": 0, "is_fixed": true, "is_starting": false}, "(9,10)": {"width": 0, "is_fixed": true, "is_starting": false}, "(10,11)": {"width": 0, "is_fixed": true, "is_starting": false}, "(11,12)": {"width": 0, "is_fixed": true, "is_starting": false}, "(12,13)": {"width": 0, "is_fixed": true, "is_starting": false}, "(13,14)": {"width": 0, "is_fixed": true, "is_starting": false}, "(14,15)": {"width": 0, "is_fixed": true, "is_starting": false}, "(15,16)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(16,17)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(17,18)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(18,19)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(19,20)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(20,21)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(21,22)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(22,23)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(23,24)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(24,25)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(25,26)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(26,27)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(27,28)": {"width": 0, "is_fixed": true, "is_starting": false}, "(28,29)": {"width": 0, "is_fixed": true, "is_starting": false}, "(29,0)": {"width": 0, "is_fixed": true, "is_starting": false}, "(30,31)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(31,32)": {"width": 0, "is_fixed": true, "is_starting": false}, "(32,33)": {"width": 0, "is_fixed": true, "is_starting": false}, "(33,34)": {"width": 0, "is_fixed": true, "is_starting": false}, "(34,35)": {"width": 0, "is_fixed": true, "is_starting": false}, "(35,36)": {"width": 0, "is_fixed": true, "is_starting": false}, "(36,37)": {"width": 0, "is_fixed": true, "is_starting": false}, "(37,38)": {"width": 0, "is_fixed": true, "is_starting": false}, "(38,39)": {"width": 0, "is_fixed": true, "is_starting": false}, "(39,40)": {"width": 0, "is_fixed": true, "is_starting": false}, "(40,41)": {"width": 0, "is_fixed": true, "is_starting": false}, "(41,42)": {"width": 0, "is_fixed": true, "is_starting": false}, "(42,43)": {"width": 0, "is_fixed": true, "is_starting": false}, "(43,44)": {"width": 0, "is_fixed": true, "is_starting": false}, "(44,45)": {"width": 0, "is_fixed": true, "is_starting": false}, "(45,46)": {"width": 0, "is_fixed": true, "is_starting": false}, "(46,47)": {"width": 0, "is_fixed": true, "is_starting": false}, "(47,48)": {"width": 0, "is_fixed": true, "is_starting": false}, "(48,49)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(49,50)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(50,51)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(51,52)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(52,53)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(53,54)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(54,55)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(55,56)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(56,57)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(57,58)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(58,59)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(59,60)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(60,61)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(61,62)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(62,63)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(63,64)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(64,65)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(65,30)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(31,30)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(30,65)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(65,64)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(64,63)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(63,62)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(62,61)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(61,60)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(60,59)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(59,58)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(58,57)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(57,56)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(56,55)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(55,54)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(54,53)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(53,52)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(52,51)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(51,50)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(50,49)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(49,48)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(48,47)": {"width": 0, "is_fixed": true, "is_starting": false}, "(47,66)": {"width": 0, "is_fixed": true, "is_starting": false}, "(66,67)": {"width": 0, "is_fixed": true, "is_starting": false}, "(67,68)": {"width": 0, "is_fixed": true, "is_starting": false}, "(68,69)": {"width": 0, "is_fixed": true, "is_starting": false}, "(69,70)": {"width": 0, "is_fixed": true, "is_starting": false}, "(70,71)": {"width": 0, "is_fixed": true, "is_starting": false}, "(71,72)": {"width": 0, "is_fixed": true, "is_starting": false}, "(72,73)": {"width": 0, "is_fixed": true, "is_starting": false}, "(73,74)": {"width": 0, "is_fixed": true, "is_starting": false}, "(74,75)": {"width": 0, "is_fixed": true, "is_starting": false}, "(75,76)": {"width": 0, "is_fixed": true, "is_starting": false}, "(76,29)": {"width": 0, "is_fixed": true, "is_starting": false}, "(29,28)": {"width": 0, "is_fixed": true, "is_starting": false}, "(28,27)": {"width": 0, "is_fixed": true, "is_starting": false}, "(27,26)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(26,25)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(25,24)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(24,23)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(23,22)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(22,21)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(21,20)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(20,19)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(19,18)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(18,17)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(17,16)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(16,15)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(15,14)": {"width": 0, "is_fixed": true, "is_starting": false}, "(14,13)": {"width": 0, "is_fixed": true, "is_starting": false}, "(13,12)": {"width": 0, "is_fixed": true, "is_starting": false}, "(12,11)": {"width": 0, "is_fixed": true, "is_starting": false}, "(11,32)": {"width": 0, "is_fixed": true, "is_starting": false}, "(32,31)": {"width": 0, "is_fixed": true, "is_starting": false}}, "closure": {"0": {"exterior": ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "0"], "interiors": []}, "1": {"exterior": ["30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63", "64", "65", "30"], "interiors": []}, "2": {"exterior": ["11", "32", "31", "30", "65", "64", "63", "62", "61", "60", "59", "58", "57", "56", "55", "54", "53", "52", "51", "50", "49", "48", "47", "66", "67", "68", "69", "70", "71", "72", "73", "74", "75", "76", "29", "28", "27", "26", "25", "24", "23", "22", "21", "20", "19", "18", "17", "16", "15", "14", "13", "12", "11"], "interiors": []}}, "closure_cargo": {"0": {"angle": 0, "region_type": "surrounding", "clamp": false}, "1": {"angle": 0, "region_type": "surrounding", "clamp": false}, "2": {"angle": 0, "region_type": "core", "clamp": false}}}'
    return Stretch.loads(json_str)


def test_split_case0(stretch_case0):
    stretch = stretch_case0
    dividing_lines = loads(
        'MULTILINESTRING ((-226.83179821988708 24.92142496396614, -206.74959210933338 24.936147305605047), (-206.74959210933338 24.936147305605047, -179.59500767884788 24.956054434674805), (-179.59500767884788 24.956054434674805, -118.68625408439192 25.00070687346969), (-118.68625408439192 25.00070687346969, -92.03325513318362 25.02024628831789), (-92.03325513318362 25.02024628831789, -9.247115088551368 25.080937122282748), (-9.247115088551368 25.080937122282748, 114.70137806015062 25.17180423378024), (-160.70625824840062 62.50395711970841, -183.6089386102226 62.50395711970841), (96.87193906218116 58.77851232631966, 31.901374294463427 58.77851232631966), (31.901374294463427 58.77851232631966, -9.247115088551368 58.77851232631966), (-9.247115088551368 58.77851232631966, -9.248115088551367 58.77851232631966), (-122.29859029557925 -14.37862773281745, -179.59500767884788 -14.37862773281745), (-179.59500767884788 -14.37862773281745, -223.25438146972652 -14.37862773281745), (190.71185804723146 -37.79180355362928, 46.74286545535957 -37.79180355362928), (-118.68625408439192 25.00070687346969, -118.68625944518446 61.82498540490811), (-206.74959210933338 37.1540057433856, -206.74959210933338 24.936147305605047), (-92.03325513318362 62.503957140461836, -92.03325513318362 25.02024628831789), (-9.247115088551368 25.080937122282748, -9.247115088551368 58.77851232631966), (-9.247115088551368 58.77851232631966, -9.247115088551368 62.50395747809556), (31.901374294463427 62.50395764591492, 31.901374294463427 58.77851232631966), (31.901374294463427 58.77851232631966, 31.901374294463427 25.111103236268775), (-179.59500767884788 -54.68814826087275, -179.59500767884788 -14.37862773281745), (-179.59500767884788 -14.37862773281745, -179.59500767884788 24.956054434674805))')

    assert len(stretch.closures) == 3
    stretch.split(dividing_lines)
    assert len(stretch.closures) == 17
    assert len([edge for edge in stretch.edges if not edge.closure]) == 0
    assert len([pivot for pivot in stretch.pivots if pivot.dangling]) == 0


@pytest.fixture
def stretch_case1() -> Stretch:
    json_str = '{"pivot": {"0": [103.29135587861752, -10.86117029946763], "1": [104.2164140753448, -60.252402334247996], "2": [77.78092941228022, -60.747517777786385], "3": [77.93167302455309, -68.7961062480313], "4": [112.41574615786298, -68.15024719222107], "5": [111.18920073600523, -2.6618381908893127], "6": [83.7964702693467, -3.1748821694257696], "7": [83.94721390752306, -11.223470639185503], "8": [66.57881991460852, 3.70514184943133], "9": [66.75948876465053, -4.34283048940188], "10": [76.64344912520808, -4.12094556273704], "11": [76.46278027516607, 3.92702677609617], "12": [23.779004529929672, -103.8701822456652], "13": [17.086701819567324, -103.87068913160324], "14": [17.08731153971389, -111.92068910851265], "15": [25.530385746108085, -111.92004961628191], "16": [58.31065180542609, -96.95055110143535], "17": [63.510228051784395, -88.30178630168962], "18": [56.61104364096414, -84.15404541471331], "19": [52.697059444232394, -90.66440840269006], "20": [39.27233687183024, 37.56162193469432], "21": [39.27233687209568, 9.343560637945332], "22": [57.18975619510687, -0.5444931868081317], "23": [61.079307144448535, 6.503477685185839], "24": [47.32233687205095, 14.095512010368978], "25": [47.322336871812716, 39.4272418341736], "26": [40.62323832986297, 53.10400634287504], "27": [40.62184192935729, 71.54051200844998], "28": [-149.72668220357988, 71.52609480921343], "29": [-187.25003154221795, 52.91577377252135], "30": [-180.05204087747916, 38.40271310188086], "31": [-165.74044506751895, 45.50078396254934], "32": [-152.57822331171604, 37.90290287980959], "33": [-148.55375215562668, 44.874712681705006], "34": [-165.45230823573002, 54.62938950583339], "35": [-176.4170832485691, 49.19122935831547], "36": [-176.4615152850747, 49.280816143739216], "37": [-147.83977570915494, 63.47623770242358], "38": [32.57245166798918, 63.48990231599737], "39": [32.573379632653705, 51.2380979620812], "40": [-4.457600210324653, -103.55975052753173], "41": [-14.527663127412048, -87.16122637589929], "42": [-14.527663127412048, -68.63545624687329], "43": [-22.57766312741206, -68.63545624687329], "44": [-22.57766312741206, -89.43561132479618], "45": [-8.96068091158169, -111.61009162121417], "46": [3.986522176393011, -111.60911097917918], "47": [3.985912456416801, -103.55911100226974], "48": [-31.36454225994058, -51.65841270612208], "49": [-36.568599980431344, -47.63231583358551], "50": [-62.25043455810138, -42.09125887818172], "51": [-63.94821747763037, -49.9601872142486], "52": [-40.05067905260113, -55.11626829975534], "53": [-36.2903552200723, -58.025426659444186], "54": [-92.50095529992754, -35.56416209603301], "55": [-135.63691749788273, 15.722636640510537], "56": [-135.63699899554243, 17.861678084134752], "57": [-143.6869989896996, 17.861371378454947], "58": [-143.6868056659223, 12.787267738825136], "59": [-96.88967773931701, -42.852499154652435], "60": [-76.91319285276722, -47.16258222920314], "61": [-75.21540993306982, -39.29365389317263], "62": [17.087131229702802, -109.54009599008222], "63": [68.66781911141652, -79.72285796319835], "64": [69.35314769363185, -80.13487266220915], "65": [70.95041473354604, -77.47804327919204], "66": [71.97858620714305, -78.09617269941538], "67": [77.56559845234779, -68.80296253141313], "68": [76.6252261191497, -3.3091938487361756], "69": [66.16672996492207, 3.6958908462979707], "70": [-150.9358355583563, 36.954835974898685], "71": [-152.1584552511522, 34.836825526413634], "72": [-146.74558853854433, 31.712252925910775], "73": [-147.04555957025195, 31.192641794826557], "74": [-143.68743305614407, 29.254166184732526], "75": [-76.2931652081123, -44.288862011180825], "76": [-63.67242677450213, -44.98903870474237], "77": [-63.941733893284464, -49.843827395784366], "78": [-63.923666045693565, -49.846262364418315], "79": [-34.899528097428785, -56.22766946317961], "80": [-34.56350988585791, -56.30016802408795], "81": [-35.854883607853935, -57.96937189175816], "82": [-33.60064705791592, -59.71335409796933], "83": [-33.05008592016793, -59.00170978440843], "84": [-22.688862302703, -67.01763424981726], "85": [-23.239423426459783, -67.72927855697486], "86": [-22.577663127412052, -68.2412471011267], "87": [3.9863655410217524, -109.54108830612387], "88": [-147.8398428485195, 63.47620440355365], "90": [-183.67325222796114, 45.70403682937753], "91": [-147.83991931275324, 63.476166479861796]}, "pivot_cargo": {"0": {}, "1": {}, "2": {}, "3": {}, "4": {}, "5": {}, "6": {}, "7": {}, "8": {}, "9": {}, "10": {}, "11": {}, "12": {}, "13": {}, "14": {}, "15": {}, "16": {}, "17": {}, "18": {}, "19": {}, "20": {}, "21": {}, "22": {}, "23": {}, "24": {}, "25": {}, "26": {}, "27": {}, "28": {}, "29": {}, "30": {}, "31": {}, "32": {}, "33": {}, "34": {}, "35": {}, "36": {}, "37": {}, "38": {}, "39": {}, "40": {}, "41": {}, "42": {}, "43": {}, "44": {}, "45": {}, "46": {}, "47": {}, "48": {}, "49": {}, "50": {}, "51": {}, "52": {}, "53": {}, "54": {}, "55": {}, "56": {}, "57": {}, "58": {}, "59": {}, "60": {}, "61": {}, "62": {}, "63": {}, "64": {}, "65": {}, "66": {}, "67": {}, "68": {}, "69": {}, "70": {}, "71": {}, "72": {}, "73": {}, "74": {}, "75": {}, "76": {}, "77": {}, "78": {}, "79": {}, "80": {}, "81": {}, "82": {}, "83": {}, "84": {}, "85": {}, "86": {}, "87": {}, "88": {}, "90": {}, "91": {}}, "edge_cargo": {"(0,1)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(1,2)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(2,3)": {"width": 0, "is_fixed": true, "is_starting": false}, "(3,4)": {"width": 0, "is_fixed": true, "is_starting": false}, "(4,5)": {"width": 0, "is_fixed": true, "is_starting": false}, "(5,6)": {"width": 0, "is_fixed": true, "is_starting": false}, "(6,7)": {"width": 0, "is_fixed": true, "is_starting": false}, "(7,0)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(8,9)": {"width": 0, "is_fixed": true, "is_starting": false}, "(9,10)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(11,8)": {"width": 0, "is_fixed": true, "is_starting": false}, "(12,13)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(14,15)": {"width": 0, "is_fixed": true, "is_starting": false}, "(15,16)": {"width": 0, "is_fixed": true, "is_starting": false}, "(16,17)": {"width": 0, "is_fixed": true, "is_starting": false}, "(17,18)": {"width": 0, "is_fixed": true, "is_starting": false}, "(18,19)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(19,12)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(20,21)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(21,22)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(22,23)": {"width": 0, "is_fixed": true, "is_starting": false}, "(23,24)": {"width": 0, "is_fixed": true, "is_starting": false}, "(24,25)": {"width": 0, "is_fixed": true, "is_starting": false}, "(25,26)": {"width": 0, "is_fixed": true, "is_starting": false}, "(26,27)": {"width": 0, "is_fixed": true, "is_starting": false}, "(27,28)": {"width": 0, "is_fixed": true, "is_starting": false}, "(28,29)": {"width": 0, "is_fixed": true, "is_starting": false}, "(30,31)": {"width": 0, "is_fixed": true, "is_starting": false}, "(31,32)": {"width": 0, "is_fixed": true, "is_starting": false}, "(32,33)": {"width": 0, "is_fixed": true, "is_starting": false}, "(33,34)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(34,35)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(35,36)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(37,38)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(38,39)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(39,20)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(40,41)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(41,42)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(42,43)": {"width": 0, "is_fixed": true, "is_starting": false}, "(43,44)": {"width": 0, "is_fixed": true, "is_starting": false}, "(44,45)": {"width": 0, "is_fixed": true, "is_starting": false}, "(45,46)": {"width": 0, "is_fixed": true, "is_starting": false}, "(47,40)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(48,49)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(49,50)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(51,52)": {"width": 0, "is_fixed": true, "is_starting": false}, "(52,53)": {"width": 0, "is_fixed": true, "is_starting": false}, "(54,55)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(55,56)": {"width": 0, "is_fixed": true, "is_starting": false}, "(56,57)": {"width": 0, "is_fixed": true, "is_starting": false}, "(57,58)": {"width": 0, "is_fixed": true, "is_starting": false}, "(58,59)": {"width": 0, "is_fixed": true, "is_starting": false}, "(59,60)": {"width": 0, "is_fixed": true, "is_starting": false}, "(61,54)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(13,62)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(62,14)": {"width": 0, "is_fixed": true, "is_starting": false}, "(10,68)": {"width": 0, "is_fixed": true, "is_starting": false}, "(68,11)": {"width": 0, "is_fixed": true, "is_starting": false}, "(60,75)": {"width": 0, "is_fixed": true, "is_starting": false}, "(75,61)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(50,78)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(78,51)": {"width": 0, "is_fixed": true, "is_starting": false}, "(53,79)": {"width": 0, "is_fixed": true, "is_starting": false}, "(79,48)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(46,87)": {"width": 0, "is_fixed": true, "is_starting": false}, "(87,47)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(62,13)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(13,12)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(12,19)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(19,18)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(18,17)": {"width": 0, "is_fixed": true, "is_starting": false}, "(17,63)": {"width": 0, "is_fixed": true, "is_starting": false}, "(63,64)": {"width": 0, "is_fixed": true, "is_starting": false}, "(64,65)": {"width": 0, "is_fixed": true, "is_starting": false}, "(65,66)": {"width": 0, "is_fixed": true, "is_starting": false}, "(66,67)": {"width": 0, "is_fixed": true, "is_starting": false}, "(67,3)": {"width": 0, "is_fixed": true, "is_starting": false}, "(3,2)": {"width": 0, "is_fixed": true, "is_starting": false}, "(2,1)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(1,0)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(0,7)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(7,6)": {"width": 0, "is_fixed": true, "is_starting": false}, "(6,68)": {"width": 0, "is_fixed": true, "is_starting": false}, "(68,10)": {"width": 0, "is_fixed": true, "is_starting": false}, "(10,9)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(9,8)": {"width": 0, "is_fixed": true, "is_starting": false}, "(8,69)": {"width": 0, "is_fixed": true, "is_starting": false}, "(69,23)": {"width": 0, "is_fixed": true, "is_starting": false}, "(23,22)": {"width": 0, "is_fixed": true, "is_starting": false}, "(22,21)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(21,20)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(20,39)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(39,38)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(38,37)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(36,35)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(35,34)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(34,33)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(33,32)": {"width": 0, "is_fixed": true, "is_starting": false}, "(32,70)": {"width": 0, "is_fixed": true, "is_starting": false}, "(70,71)": {"width": 0, "is_fixed": true, "is_starting": false}, "(71,72)": {"width": 0, "is_fixed": true, "is_starting": false}, "(72,73)": {"width": 0, "is_fixed": true, "is_starting": false}, "(73,74)": {"width": 0, "is_fixed": true, "is_starting": false}, "(74,57)": {"width": 0, "is_fixed": true, "is_starting": false}, "(57,56)": {"width": 0, "is_fixed": true, "is_starting": false}, "(56,55)": {"width": 0, "is_fixed": true, "is_starting": false}, "(55,54)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(54,61)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(61,75)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(75,76)": {"width": 0, "is_fixed": true, "is_starting": false}, "(76,77)": {"width": 0, "is_fixed": true, "is_starting": false}, "(77,78)": {"width": 0, "is_fixed": true, "is_starting": false}, "(78,50)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(50,49)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(49,48)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(48,79)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(79,80)": {"width": 0, "is_fixed": true, "is_starting": false}, "(80,81)": {"width": 0, "is_fixed": true, "is_starting": false}, "(81,82)": {"width": 0, "is_fixed": true, "is_starting": false}, "(82,83)": {"width": 0, "is_fixed": true, "is_starting": false}, "(83,84)": {"width": 0, "is_fixed": true, "is_starting": false}, "(84,85)": {"width": 0, "is_fixed": true, "is_starting": false}, "(85,86)": {"width": 0, "is_fixed": true, "is_starting": false}, "(86,43)": {"width": 0, "is_fixed": true, "is_starting": false}, "(43,42)": {"width": 0, "is_fixed": true, "is_starting": false}, "(42,41)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(41,40)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(40,47)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(47,87)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(87,62)": {"width": 0, "is_fixed": true, "is_starting": false}, "(88,37)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(37,88)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(29,90)": {"width": 0, "is_fixed": true, "is_starting": false}, "(90,30)": {"width": 0, "is_fixed": true, "is_starting": false}, "(36,90)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(90,36)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(36,91)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(91,88)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(88,91)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(91,36)": {"width": 2.75, "is_fixed": false, "is_starting": false}}, "closure": {"0": {"exterior": ["0", "1", "2", "3", "4", "5", "6", "7", "0"], "interiors": []}, "1": {"exterior": ["10", "68", "11", "8", "9", "10"], "interiors": []}, "2": {"exterior": ["12", "13", "62", "14", "15", "16", "17", "18", "19", "12"], "interiors": []}, "4": {"exterior": ["40", "41", "42", "43", "44", "45", "46", "87", "47", "40"], "interiors": []}, "5": {"exterior": ["48", "49", "50", "78", "51", "52", "53", "79", "48"], "interiors": []}, "6": {"exterior": ["54", "55", "56", "57", "58", "59", "60", "75", "61", "54"], "interiors": []}, "10": {"exterior": ["30", "31", "32", "33", "34", "35", "36", "90", "30"], "interiors": []}, "11": {"exterior": ["20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "90", "36", "91", "88", "37", "38", "39", "20"], "interiors": []}, "12": {"exterior": ["0", "7", "6", "68", "10", "9", "8", "69", "23", "22", "21", "20", "39", "38", "37", "88", "91", "36", "35", "34", "33", "32", "70", "71", "72", "73", "74", "57", "56", "55", "54", "61", "75", "76", "77", "78", "50", "49", "48", "79", "80", "81", "82", "83", "84", "85", "86", "43", "42", "41", "40", "47", "87", "62", "13", "12", "19", "18", "17", "63", "64", "65", "66", "67", "3", "2", "1", "0"], "interiors": []}}, "closure_cargo": {"0": {"angle": 0, "region_type": "surrounding", "clamp": false}, "1": {"angle": 0, "region_type": "surrounding", "clamp": false}, "2": {"angle": 0, "region_type": "surrounding", "clamp": false}, "4": {"angle": 0, "region_type": "surrounding", "clamp": false}, "5": {"angle": 0, "region_type": "surrounding", "clamp": false}, "6": {"angle": 0, "region_type": "surrounding", "clamp": false}, "10": {"angle": 0, "region_type": "surrounding", "clamp": false}, "11": {"angle": 0, "region_type": "surrounding", "clamp": false}, "12": {"angle": 90, "region_type": "core", "clamp": false}}}'
    return Stretch.loads(json_str)


def test_split_case1(stretch_case1):
    stretch = stretch_case1
    dividing_lines = loads(
        'MULTILINESTRING ((37.517148491518576 41.144984381986376, -8.638404439152058 41.144984381986376), (-8.638404439152058 41.144984381986376, -58.89920337977105 41.144984381986376), (-58.89920337977105 41.144984381986376, -109.15704101037772 41.144984381986376), (-109.15704101037772 41.144984381986376, -150.70673457895484 41.144984381986376), (-135.63699898385693 17.861371378454947, -109.15704101037772 17.861371378454947), (-109.15704101037772 17.861371378454947, -58.89920337977105 17.861371378454947), (-58.89920337977105 17.861371378454947, -43.68387302652263 17.861371378454947), (-43.68387302652263 17.861371378454947, -8.638404439152051 17.861371378454947), (-8.638404439152051 17.861371378454947, -2.835515942661914 17.861371378454947), (-2.835515942661914 17.861371378454947, 28.827767421728822 17.861371378454947), (28.827767421728822 17.861371378454947, 39.27233687201556 17.861371378454947), (48.262306424602684 4.382282386008728, 48.262306424602684 -21.788764952350903), (48.262306424602684 -21.788764952350903, 48.262306424602684 -29.58852625935623), (48.262306424602684 -29.58852625935623, 48.262306424602684 -36.637005864303376), (48.262306424602684 -36.637005864303376, 48.262306424602684 -57.7767575018961), (48.262306424602684 -57.7767575018961, 48.262306424602684 -78.65533639552984), (48.262306424602684 -78.65533639552984, 48.262306424602684 -92.68959113369439), (-58.89920337977105 41.144984381986376, -58.89920337977105 17.861371378454947), (-8.638404439152051 17.861371378454947, -8.638404439152058 41.144984381986376), (-109.15704101037772 41.144984381986376, -109.15704101037772 17.861371378454947), (83.94721390752306 -60.63202821057177, 83.94721390752306 -57.7767575018961), (83.94721390752306 -57.7767575018961, 83.94721390752306 -29.58852625935623), (83.94721390752306 -29.58852625935623, 83.94721390752306 -11.223470639185503), (-43.68387302652263 17.861371378454947, -43.68387302652263 -21.788764952350903), (-43.68387302652263 -21.788764952350903, -43.68387302652263 -36.637005864303376), (-43.68387302652263 -36.637005864303376, -43.68387302652263 -46.0971399456479), (-2.835515942661914 -87.41652128140854, -2.835515942661914 -78.65533639552984), (-2.835515942661914 -78.65533639552984, -2.835515942661914 -36.637005864303376), (-2.835515942661914 -36.637005864303376, -2.835515942661914 -21.788764952350903), (-2.835515942661914 -21.788764952350903, -2.835515942661914 17.861371378454947), (28.827767421728822 -101.56460460105922, 28.827767421728822 -78.65533639552984), (28.827767421728822 -78.65533639552984, 28.827767421728822 -36.637005864303376), (28.827767421728822 -36.637005864303376, 28.827767421728822 -21.788764952350903), (28.827767421728822 -21.788764952350903, 28.827767421728822 17.861371378454947), (48.262306424602684 -29.58852625935623, 83.94721390752306 -29.58852625935623), (83.94721390752306 -29.58852625935623, 103.64210424872348 -29.58852625935623), (48.262306424602684 -21.788764952350903, 28.827767421728822 -21.788764952350903), (28.827767421728822 -21.788764952350903, -2.835515942661914 -21.788764952350903), (-2.835515942661914 -21.788764952350903, -43.68387302652263 -21.788764952350903), (-43.68387302652263 -21.788764952350903, -104.0870754144648 -21.788764952350903), (48.262306424602684 -36.637005864303376, 28.827767421728822 -36.637005864303376), (28.827767421728822 -36.637005864303376, -2.835515942661914 -36.637005864303376), (-2.835515942661914 -36.637005864303376, -43.68387302652263 -36.637005864303376), (-43.68387302652263 -36.637005864303376, -51.093210775128476 -36.637005864303376), (-14.527663127412048 -78.65533639552984, -2.835515942661914 -78.65533639552984), (-2.835515942661914 -78.65533639552984, 28.827767421728822 -78.65533639552984), (28.827767421728822 -78.65533639552984, 48.262306424602684 -78.65533639552984), (104.1700472314738 -57.7767575018961, 83.94721390752306 -57.7767575018961), (83.94721390752306 -57.7767575018961, 48.262306424602684 -57.7767575018961))')

    assert len(stretch.closures) == 9
    stretch.split(dividing_lines, dist_tol_to_edge=0.01, dist_tol_to_pivot=0.01)
    assert len(stretch.closures) == 32


@pytest.fixture
def stretch_case2() -> Stretch:
    json_str = '{"pivot": {"0": [-52.6420384908301, -57.62867978869787], "1": [-57.273897833435385, -46.78000306415852], "2": [-56.97610703188033, -46.78004049386907], "3": [-56.9746393359554, -35.10305075902782], "4": [-53.52463936320745, -35.10348439398136], "5": [-53.51971716336672, 4.057540745885831], "6": [-56.96971713611468, 4.057974380839358], "7": [-56.96769095562207, 20.178267700379422], "8": [-53.517690982874086, 20.1778340654259], "9": [-53.511948889774054, 65.86193051024682], "10": [-58.81194884790856, 65.86259667408846], "11": [-58.80797829914234, 97.45228524496349], "12": [-55.15718400338393, 107.3034540079534], "13": [7.3830018600241, 84.31794812590586], "14": [6.19285423919524, 81.07973123375133], "15": [72.91872874833643, 56.5558517529747], "16": [70.11391295094138, 41.01905968683841], "17": [78.03585930910069, 39.588931756041255], "18": [82.04182792118763, 61.77930212363028], "19": [-56.13987676390255, 112.56547011379766], "20": [-61.55791631148577, 97.94563190686836], "21": [-61.57610699554425, -46.77946231393104], "22": [-57.73990207320814, -46.779944491483604], "23": [-61.57631293365466, -48.41790605465168], "24": [-56.52348150304488, -60.252577766302714], "25": [-27.62146670254745, -89.1564956408736], "26": [-31.330408895651587, -112.77622473019075], "27": [45.76086852448951, -107.86293258403357], "28": [52.43281490121808, -102.23470516276252], "29": [60.83488270903468, -55.692903525451015], "30": [52.91293635087535, -54.26277559465385], "31": [45.02598483286408, -97.95117962453786], "32": [42.59949378739657, -99.99808508037357], "33": [-21.81995251495391, -104.1037578638643], "34": [-19.03370302915573, -86.36003079027563], "35": [-46.21085273129075, -59.18109158965492], "36": [-48.65045143835222, -61.62052967013667], "37": [64.99352011563796, 12.655529054046298], "38": [59.543410123528446, -17.534412750316314], "39": [67.4653564816878, -18.964540681113483], "40": [72.91546647379732, 11.225401123249142]}, "pivot_cargo": {"0": {}, "1": {}, "2": {}, "3": {}, "4": {}, "5": {}, "6": {}, "7": {}, "8": {}, "9": {}, "10": {}, "11": {}, "12": {}, "13": {}, "14": {}, "15": {}, "16": {}, "17": {}, "18": {}, "19": {}, "20": {}, "21": {}, "22": {}, "23": {}, "24": {}, "25": {}, "26": {}, "27": {}, "28": {}, "29": {}, "30": {}, "31": {}, "32": {}, "33": {}, "34": {}, "35": {}, "36": {}, "37": {}, "38": {}, "39": {}, "40": {}}, "edge_cargo": {"(0,1)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(1,2)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(2,3)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(3,4)": {"width": 4.206483847696335, "is_fixed": true, "is_starting": false}, "(4,5)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(5,6)": {"width": 4.206391680514352, "is_fixed": true, "is_starting": false}, "(6,7)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(7,8)": {"width": 4.2064838475996424, "is_fixed": true, "is_starting": false}, "(8,9)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(9,10)": {"width": 4.97597936698066, "is_fixed": true, "is_starting": false}, "(10,11)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(11,12)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(12,13)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(13,14)": {"width": 4.199226541884095, "is_fixed": true, "is_starting": false}, "(14,15)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(15,16)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(16,17)": {"width": 0, "is_fixed": true, "is_starting": false}, "(17,18)": {"width": 0, "is_fixed": true, "is_starting": false}, "(18,19)": {"width": 0, "is_fixed": true, "is_starting": false}, "(19,20)": {"width": 0, "is_fixed": true, "is_starting": false}, "(20,21)": {"width": 0, "is_fixed": true, "is_starting": false}, "(21,22)": {"width": 0, "is_fixed": true, "is_starting": false}, "(22,23)": {"width": 0, "is_fixed": true, "is_starting": false}, "(23,24)": {"width": 0, "is_fixed": true, "is_starting": false}, "(24,25)": {"width": 0, "is_fixed": true, "is_starting": false}, "(25,26)": {"width": 0, "is_fixed": true, "is_starting": false}, "(26,27)": {"width": 0, "is_fixed": true, "is_starting": false}, "(27,28)": {"width": 0, "is_fixed": true, "is_starting": false}, "(28,29)": {"width": 0, "is_fixed": true, "is_starting": false}, "(29,30)": {"width": 0, "is_fixed": true, "is_starting": false}, "(30,31)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(31,32)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(32,33)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(33,34)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(34,35)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(35,36)": {"width": 6.534209578141119, "is_fixed": true, "is_starting": false}, "(36,0)": {"width": 1.9, "is_fixed": true, "is_starting": false}, "(37,38)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(38,39)": {"width": 0, "is_fixed": true, "is_starting": false}, "(39,40)": {"width": 0, "is_fixed": true, "is_starting": false}, "(40,37)": {"width": 0, "is_fixed": true, "is_starting": false}, "(29,39)": {"width": 0, "is_fixed": true, "is_starting": false}, "(39,38)": {"width": 0, "is_fixed": true, "is_starting": false}, "(38,37)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(37,40)": {"width": 0, "is_fixed": true, "is_starting": false}, "(40,17)": {"width": 0, "is_fixed": true, "is_starting": false}, "(17,16)": {"width": 0, "is_fixed": true, "is_starting": false}, "(16,15)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(15,14)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(14,13)": {"width": 1.3007734581159047, "is_fixed": true, "is_starting": false}, "(13,12)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(12,11)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(11,10)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(10,9)": {"width": 0.5240206330193402, "is_fixed": true, "is_starting": false}, "(9,8)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(8,7)": {"width": 1.2935161524003576, "is_fixed": true, "is_starting": false}, "(7,6)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(6,5)": {"width": 1.2936083194856476, "is_fixed": true, "is_starting": false}, "(5,4)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(4,3)": {"width": 1.2935161523036651, "is_fixed": true, "is_starting": false}, "(3,2)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(2,1)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(1,0)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(0,36)": {"width": 3.6, "is_fixed": true, "is_starting": false}, "(36,35)": {"width": -1.0342095781411187, "is_fixed": true, "is_starting": false}, "(35,34)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(34,33)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(33,32)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(32,31)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(31,30)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(30,29)": {"width": 0, "is_fixed": true, "is_starting": false}}, "closure": {"0": {"exterior": ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "0"], "interiors": []}, "1": {"exterior": ["37", "38", "39", "40", "37"], "interiors": []}, "2": {"exterior": ["0", "36", "35", "34", "33", "32", "31", "30", "29", "39", "38", "37", "40", "17", "16", "15", "14", "13", "12", "11", "10", "9", "8", "7", "6", "5", "4", "3", "2", "1", "0"], "interiors": []}}, "closure_cargo": {"0": {"angle": 0, "region_type": "surrounding", "clamp": false}, "1": {"angle": 0, "region_type": "surrounding", "clamp": false}, "2": {"angle": 169.76676264765408, "region_type": "core", "clamp": false}}}'
    return Stretch.loads(json_str)


def test_split_case2(stretch_case2):
    stretch = stretch_case2
    dividing_lines = loads(
        'MULTILINESTRING ((-16.741118015258667 -23.73459795490389, -15.106879141804978 -14.682014325325804), (-15.106879141804978 -14.682014325325804, -13.249485717477986 -4.39330465143675), (-13.249485717477986 -4.39330465143675, -7.799375724810199 25.796637162123016), (-7.799375724810199 25.796637162123016, -6.671735869070945 32.04300313954708), (-6.671735869070945 32.04300313954708, -2.6817551428069146 54.144811382902006), (-2.6817551428069146 54.144811382902006, -2.6789828914575784 54.160167789844564), (-2.6789828914575784 54.160167789844564, 3.052638663889192 85.90949422289945), (-53.512268248927306 63.321108878900816, -2.6817551428069146 54.144811382902006), (-7.799375724810199 25.796637162123016, 3.2653324788868736 23.79915478376411), (3.2653324788868736 23.79915478376411, 43.786468010542656 16.48398183157268), (43.786468010542656 16.48398183157268, 64.99352011529187 12.655529052129147), (78.03585930870524 39.58893175385077, 8.385725313375184 52.162685412041064), (8.385725313375184 52.162685412041064, -2.6789828914575784 54.160167789844564), (36.479948685295106 -23.994847308696613, 36.478964592579814 -23.994669653053037), (36.478964592579814 -23.994669653053037, -4.042170939439657 -16.67949670287625), (-4.042170939439657 -16.67949670287625, -15.106879141804978 -14.682014325325804), (-15.106879141804978 -14.682014325325804, -53.52120091382493 -7.7471788663338454), (-6.671735869070945 32.04300313954708, -53.51513672418587 40.49951785293294), (59.54341012358205 -17.53441275001938, 38.33635801824278 -13.705959973844191), (38.33635801824278 -13.705959973844191, -2.1847775145403885 -6.390787027897726), (-2.1847775145403885 -6.390787027897726, -13.249485717477986 -4.39330465143675), (-10.34258478015509 -42.843424412939214, -8.815251286949424 -43.11914987088343), (-8.815251286949424 -43.11914987088343, 31.705884245574993 -50.43432281826309), (31.705884245574993 -50.43432281826309, 52.91293635077886 -54.26277559518836), (-19.801416027347617 -103.9751095938877, -8.815251286949424 -43.11914987088343), (-8.815251286949424 -43.11914987088343, -4.042170939439657 -16.67949670287625), (-4.042170939439657 -16.67949670287625, -2.1847775145403885 -6.390787027897726), (-2.1847775145403885 -6.390787027897726, 3.2653324788868736 23.79915478376411), (3.2653324788868736 23.79915478376411, 8.385725313375184 52.162685412041064), (8.385725313375184 52.162685412041064, 13.144785370392203 78.52467560541668), (43.788588172204065 16.49572610045284, 43.786468010542656 16.48398183157268), (43.786468010542656 16.48398183157268, 38.33635801824278 -13.705959973844191), (38.33635801824278 -13.705959973844191, 36.478964592579814 -23.994669653053037), (36.478964592579814 -23.994669653053037, 31.705884245574993 -50.43432281826309), (31.705884245574993 -50.43432281826309, 22.527327025494664 -101.27735327515501))')

    assert len(stretch.closures) == 3
    stretch.split(dividing_lines)
    assert len(stretch.closures) == 19


@pytest.fixture
def stretch_case3() -> Stretch:
    json_str = '{"pivot": {"0": [-91.41404426369701, 40.33005929848014], "1": [-91.4140442609567, -40.96595942181256], "2": [76.78083142080845, -40.9659793934391], "3": [92.9859557363028, -24.3631462703513], "4": [92.9859557363028, 40.33005929848014], "5": [84.9359557363028, 32.280059298480126], "6": [84.93595573630277, -21.0857456623545], "7": [73.38910705415881, -32.91597899070233], "8": [-83.36404426122803, -32.915960377677465], "9": [-83.36404426342567, 32.28005929848014], "17": [1.6860521516363747, -32.915970476610376], "32": [30.035955738771978, -32.915973842906084], "34": [30.035955738771978, 32.280059298480126], "37": [-34.76404426122802, -32.9159661484897], "38": [-67.16404426122803, -32.91596230128155], "41": [30.035955738771978, -16.71597489376387], "42": [84.93595573630277, -16.715974893763864], "43": [1.6860521516364315, 15.084020606561126], "44": [30.035955738771968, 15.084020606561182], "45": [-67.16404426122807, -18.515979393438865], "46": [-34.76404426122804, -18.515979393438922]}, "pivot_cargo": {"0": {}, "1": {}, "2": {}, "3": {}, "4": {}, "5": {}, "6": {}, "7": {}, "8": {}, "9": {}, "17": {}, "32": {}, "34": {}, "37": {}, "38": {}, "41": {}, "42": {}, "43": {}, "44": {}, "45": {}, "46": {}}, "edge_cargo": {"(0,1)": {"width": 0, "is_fixed": true, "is_starting": false}, "(1,2)": {"width": 0, "is_fixed": true, "is_starting": false}, "(2,3)": {"width": 0, "is_fixed": true, "is_starting": false}, "(3,4)": {"width": 0, "is_fixed": true, "is_starting": false}, "(4,0)": {"width": 0, "is_fixed": true, "is_starting": false}, "(6,7)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(7,6)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(8,9)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(9,8)": {"width": 2.75, "is_fixed": true, "is_starting": true}, "(32,17)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(17,32)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(9,34)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(34,9)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(17,37)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(37,17)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(38,8)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(8,38)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(32,41)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(41,32)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(42,6)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(6,42)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(5,42)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(42,5)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(7,32)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(32,7)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(37,38)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(38,37)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(34,5)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(5,34)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(42,41)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(41,42)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(44,34)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(34,44)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(43,44)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(44,43)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(45,46)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(46,45)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(44,41)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(41,44)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(43,17)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(17,43)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(38,45)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(45,38)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(46,37)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(37,46)": {"width": 2.75, "is_fixed": false, "is_starting": false}}, "closure": {"0": {"exterior": ["0", "1", "2", "3", "4", "0"], "interiors": [["5", "42", "6", "7", "32", "17", "37", "38", "8", "9", "34", "5"]]}, "72": {"exterior": ["7", "6", "42", "41", "32", "7"], "interiors": []}, "73": {"exterior": ["34", "44", "41", "42", "5", "34"], "interiors": []}, "76": {"exterior": ["43", "17", "32", "41", "44", "43"], "interiors": []}, "78": {"exterior": ["43", "44", "34", "9", "8", "38", "45", "46", "37", "17", "43"], "interiors": []}, "79": {"exterior": ["46", "45", "38", "37", "46"], "interiors": []}}, "closure_cargo": {"0": {"angle": 0, "region_type": "surrounding", "clamp": false, "seena0acc69b-2201-48": true}, "72": {"angle": 0.0, "region_type": "core", "clamp": false, "seena0acc69b-2201-48": true}, "73": {"angle": 270, "region_type": "building", "clamp": false, "seena0acc69b-2201-48": true}, "76": {"angle": 270, "region_type": "building", "clamp": false, "seena0acc69b-2201-48": true}, "78": {"angle": 270, "region_type": "core", "clamp": false, "seena0acc69b-2201-48": true}, "79": {"angle": 270, "region_type": "building", "clamp": false, "seena0acc69b-2201-48": false}}}'
    return Stretch.loads(json_str)


def test_split_case3(stretch_case3):
    stretch = stretch_case3
    dividing_lines = loads(
        'MULTILINESTRING ((-67.16404426122801 32.28005929848014, -67.16404426122807 -18.515979393438865), (-50.96404426122802 32.28005929848013, -50.96404426122803 -18.515979393438894), (-34.76404426122802 32.28005929848013, -34.76404426122804 -21.20184372295195), (-18.56404426122802 32.28005929848013, -18.564044261228034 -32.915968072093804), (-2.364044261228017 32.28005929848013, -2.364044261228031 -32.9159699956979), (13.835955738771972 32.280059298480126, 13.835955738771968 15.08402060656115))')

    assert len(stretch.closures) == 6
    stretch.split(dividing_lines)
    assert len(stretch.closures) == 12


@pytest.fixture
def stretch_case4() -> Stretch:
    json_str = '{"pivot": {"0": [-39.45873254462499, 124.73790779380283], "1": [-62.83766677696752, 92.37471221102692], "2": [-62.83766677696752, 44.037907793802674], "3": [-64.93766677696752, 44.037907793802674], "4": [-64.93766677696746, -73.71209220612616], "5": [-61.88766677696752, -73.71209220612616], "6": [-61.887666776967436, -86.77312703550774], "7": [-53.05822597367154, -95.01209220619705], "8": [3.0011820026950033, -95.01209220619705], "9": [24.746451140575914, -93.46347215885532], "10": [56.66367611144763, -83.41471062464586], "11": [74.17985788639731, -71.02158696273557], "12": [100.26061454987092, -35.327431000868955], "13": [100.01517397290434, -18.973296641710704], "14": [-17.783212025386398, 124.73790779380283]}, "pivot_cargo": {"0": {}, "1": {}, "2": {}, "3": {}, "4": {}, "5": {}, "6": {}, "7": {}, "8": {}, "9": {}, "10": {}, "11": {}, "12": {}, "13": {}, "14": {}}, "edge_cargo": {"(0,1)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(1,2)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(2,3)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(3,4)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(4,5)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(5,6)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(6,7)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(7,8)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(8,9)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(9,10)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(10,11)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(11,12)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(12,13)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(13,14)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(14,0)": {"width": 2.75, "is_fixed": false, "is_starting": false}}, "closure": {"0": {"exterior": ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "0"], "interiors": []}}, "closure_cargo": {"0": {"angle": 0, "region_type": "core", "clamp": false}}}'
    return Stretch.loads(json_str)


def test_split_case4(stretch_case4):
    stretch = stretch_case4
    dividing_lines = loads(
        'MULTILINESTRING ((-0.6056013352934357 13.666627785848709, -0.6056013352934357 -2.0475705548841665, -6.11130455784275 -2.0475705548841665), (-34.09569795693843 65.56023126700507, -6.682077083355665 65.56023126700507), (-6.682077083355665 65.56023126700507, -6.682077083355665 63.96885897313261), (30.69480698544408 -33.28352178738959, -5.936040470100707 -33.28352178738959), (-5.936040470100707 -33.28352178738959, -6.11130455784275 -33.28352178738959, -6.11130455784275 -2.0475705548841665), (-5.936040470100707 -65.6454290844602, -5.936040470100707 -33.28352178738959), (-0.6056013352934357 13.666627785848709, -6.682077083355665 13.666627785848709, -6.682077083355665 63.96885897313261), (-5.936040470100707 -65.6454290844602, -64.93766677696746 -65.6454290844602), (30.69480698544408 -33.28352178738959, 100.22993984428231 -33.28352178738959), (-0.6056013352934357 13.666627785848709, 73.26061136398828 13.666627785848709), (-6.682077083355665 65.56023126700507, 30.724034221469555 65.56023126700507), (-34.09569795693843 65.56023126700507, -34.09569795693843 63.96885897313261, -62.83766677696752 63.96885897313261), (-6.11130455784275 -2.0475705548841665, -64.93766677696749 -2.0475705548841665))')

    assert len(stretch.closures) == 1
    stretch.split(dividing_lines)
    assert len(stretch.closures) == 6


@pytest.fixture
def stretch_case5() -> Stretch:
    json_str = '{"pivot": {"0": [2.7148984766278166, -86.96209220619696], "1": [-54.94262922447479, -86.96209220619696], "2": [-57.28766677696744, -84.77388084045188], "3": [-57.28766677696745, -83.42209220608424], "4": [-61.88766677696747, -83.42209220608427], "5": [-61.88766677696746, -86.77312703550767], "6": [-53.05822597367159, -95.01209220619698], "7": [3.001182002695003, -95.01209220619693], "8": [24.74645114057597, -93.4634721588552], "9": [56.663676111447586, -83.41471062464579], "10": [74.17985788639739, -71.0215869627354], "11": [85.11997127300536, -56.048934194229346], "12": [78.62017484480619, -51.29970832131386], "13": [68.45629081753484, -65.21001262455677], "14": [53.04350267584172, -76.1149342489715], "15": [23.231163147753996, -85.50099744738677], "16": [-64.93766677696748, -12.721093528274224], "17": [-64.93766677696748, -51.70109220612618], "18": [-56.887666776967485, -51.70109220612618], "19": [-56.887666776967485, -12.721093528274224], "20": [22.77595724114773, 62.55823995819805], "21": [92.0082433532339, -21.90348792266058], "22": [92.25708161457443, -38.48401592386575], "23": [85.16903408930922, -48.18472657016838], "24": [88.88320347685162, -50.8985699261201], "25": [100.26061454987092, -35.32743100086887], "26": [100.01517397290432, -18.973296641710558], "27": [29.001714478702198, 67.66142002743324], "28": [-56.887666776967514, 6.899049624297184], "29": [-56.887666776967514, 44.037907793802795], "30": [-64.9376667769675, 44.037907793802795], "31": [-64.9376667769675, 6.899049624297184], "32": [-62.83766677696753, 81.51961665528275], "33": [-54.78766677696752, 81.51961665528275], "34": [-54.78766677696752, 89.77121380718407], "35": [-35.343245200744526, 116.68790779380296], "36": [-21.59349558407771, 116.68790779380296], "37": [2.8968366990347216, 86.81029003524473], "38": [9.122593936589155, 91.91347010447987], "39": [-17.783212025386348, 124.73790779380295], "40": [-39.458732544625, 124.73790779380293], "41": [-62.837666776967446, 92.37471221102702], "42": [-64.93766677696746, -73.71209220612604], "43": [-61.88766677696752, -73.71209220612604], "44": [-62.83766677696752, 44.037907793802795]}, "pivot_cargo": {"0": {}, "1": {}, "2": {}, "3": {}, "4": {}, "5": {}, "6": {}, "7": {}, "8": {}, "9": {}, "10": {}, "11": {}, "12": {}, "13": {}, "14": {}, "15": {}, "16": {}, "17": {}, "18": {}, "19": {}, "20": {}, "21": {}, "22": {}, "23": {}, "24": {}, "25": {}, "26": {}, "27": {}, "28": {}, "29": {}, "30": {}, "31": {}, "32": {}, "33": {}, "34": {}, "35": {}, "36": {}, "37": {}, "38": {}, "39": {}, "40": {}, "41": {}, "42": {}, "43": {}, "44": {}}, "edge_cargo": {"(0,1)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(1,2)": {"width": 1.9, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(2,3)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(3,4)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(4,5)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(5,6)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(6,7)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(7,8)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(8,9)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(9,10)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(10,11)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(11,12)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(12,13)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(13,14)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(14,15)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(15,0)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(16,17)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(17,18)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(18,19)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(19,16)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(20,21)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(21,22)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(22,23)": {"width": 1.9, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(23,24)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(24,25)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(25,26)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(26,27)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(27,20)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(28,29)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(30,31)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(31,28)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(32,33)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(33,34)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(34,35)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(35,36)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(36,37)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(37,38)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(38,39)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(39,40)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(40,41)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(41,32)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(29,44)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(44,30)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(16,19)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(19,18)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(18,17)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(17,42)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(42,43)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(43,4)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(4,3)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(3,2)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(2,1)": {"width": 3.6, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(1,0)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(0,15)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(15,14)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(14,13)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(13,12)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(12,11)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(11,24)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(24,23)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(23,22)": {"width": 3.6, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(22,21)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(21,20)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(20,27)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(27,38)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(38,37)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(37,36)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(36,35)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(35,34)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(34,33)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(33,32)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(32,44)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(44,29)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(29,28)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(28,31)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(31,16)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}}, "closure": {"0": {"exterior": ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "0"], "interiors": []}, "1": {"exterior": ["16", "17", "18", "19", "16"], "interiors": []}, "2": {"exterior": ["20", "21", "22", "23", "24", "25", "26", "27", "20"], "interiors": []}, "3": {"exterior": ["28", "29", "44", "30", "31", "28"], "interiors": []}, "4": {"exterior": ["32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "32"], "interiors": []}, "5": {"exterior": ["0", "15", "14", "13", "12", "11", "24", "23", "22", "21", "20", "27", "38", "37", "36", "35", "34", "33", "32", "44", "29", "28", "31", "16", "19", "18", "17", "42", "43", "4", "3", "2", "1", "0"], "interiors": []}}, "closure_cargo": {"0": {"angle": 0, "region_type": "surrounding", "clamp": false, "seen7ba44480-bc79-40": false}, "1": {"angle": 0, "region_type": "surrounding", "clamp": false, "seen7ba44480-bc79-40": false}, "2": {"angle": 0, "region_type": "surrounding", "clamp": false, "seen7ba44480-bc79-40": false}, "3": {"angle": 0, "region_type": "surrounding", "clamp": false, "seen7ba44480-bc79-40": false}, "4": {"angle": 0, "region_type": "surrounding", "clamp": false, "seen7ba44480-bc79-40": false}, "5": {"angle": 90, "region_type": "core", "clamp": false, "seen7ba44480-bc79-40": true}}}'
    return Stretch.loads(json_str)


def test_split_case5(stretch_case5):
    stretch = stretch_case5
    dividing_lines = loads(
        'MULTILINESTRING ((-27.087666816184125 -86.96209220619696, -27.087666816184125 -83.41209220608425), (-27.087666816184125 -83.41209220608425, -27.087666816184125 -50.96209224740073), (-27.087666816184125 -50.96209224740073, -27.087666816184125 -45.562092208399804), (-27.087666816184125 -45.562092208399804, -27.087666816184125 -20.41209372709841), (-27.087666816184125 -20.41209372709841, -27.087666816184125 -8.562092227141648), (-27.087666816184125 -8.562092227141648, -27.087666816184125 16.237896621901314), (-27.087666816184125 16.237896621901314, -27.087666816184125 33.83790779311755), (-27.087666816184125 33.83790779311755, -27.087666816184125 44.03790779418148), (-27.087666816184125 44.03790779418148, -27.087666816184125 85.73790778799435), (-27.087666816184125 85.73790778799435, -27.087666816184125 116.68790779380296), (-62.83766677696752 44.03790779418148, -27.087666816184125 44.03790779418148), (-27.087666816184125 44.03790779418148, -10.7876668160429 44.03790779418148), (-10.7876668160429 44.03790779418148, 22.712333182566056 44.03790779418148), (22.712333182566056 44.03790779418148, 37.956855944507666 44.03790779418148), (14.184629818699484 85.73790778799435, -10.7876668160429 85.73790778799435), (-10.7876668160429 85.73790778799435, -27.087666816184125 85.73790778799435), (-27.087666816184125 85.73790778799435, -54.78766677696752 85.73790778799435), (-10.7876668160429 85.73790778799435, -10.7876668160429 44.03790779418148), (22.712333182566056 44.03790779418148, 22.712333182566056 33.83790779311755), (22.712333182566056 33.83790779311755, 22.712333182566056 -8.562092227141648), (22.712333182566056 -8.562092227141648, 22.712333182566056 -50.96209224740073), (22.712333182566056 -50.96209224740073, 22.712333182566056 -85.53794665597816), (54.012333182565925 -4.011092247400232, 54.012333182565925 -8.562092227141648), (54.012333182565925 -8.562092227141648, 54.012333182565925 -50.96209224740073), (54.012333182565925 -50.96209224740073, 54.012333182565925 -75.42946315535475), (46.31767611874157 33.83790779311755, 22.712333182566056 33.83790779311755), (22.712333182566056 33.83790779311755, -27.087666816184125 33.83790779311755), (81.07245803245965 -8.562092227141648, 54.012333182565925 -8.562092227141648), (54.012333182565925 -8.562092227141648, 22.712333182566056 -8.562092227141648), (22.712333182566056 -8.562092227141648, -27.087666816184125 -8.562092227141648), (-27.087666816184125 16.237896621901314, -56.887666776967514 16.237896621901314), (-56.887666776967485 -20.41209372709841, -27.087666816184125 -20.41209372709841), (-27.087666816184125 -50.96209224740073, 22.712333182566056 -50.96209224740073), (22.712333182566056 -50.96209224740073, 54.012333182565925 -50.96209224740073), (54.012333182565925 -50.96209224740073, 88.83678943064784 -50.96209224740073), (-27.087666816184125 -45.562092208399804, -56.887666776967485 -45.562092208399804), (-61.88766677696747 -83.41209220608425, -27.087666816184125 -83.41209220608425))')
    assert len(stretch.closures) == 6
    stretch.split(dividing_lines, dist_tol_to_edge=0.01, dist_tol_to_pivot=0.01, end_attach_ratio_digit=5)
    assert all([closure.shape.is_valid for closure in stretch.closures])


@pytest.fixture
def stretch_case6() -> Stretch:
    json_str = '{"pivot": {"0": [112.68917842954396, -68.29111726300722], "1": [46.57805143785591, -154.7608818239292], "2": [16.77302405984735, -154.76088182096018], "3": [8.401884168662184, -148.36066210029975], "4": [-2.2271896591442597, -148.36066209925087], "5": [-2.227189659938644, -156.41066209925089], "6": [5.677109495986806, -156.41066210003092], "7": [14.048249387168688, -162.81088182068885], "8": [50.556609244214535, -162.81088182432552], "9": [123.97359163153085, -66.78545507776124], "10": [93.50767791139279, -43.49250521250863], "11": [82.41325710208869, -34.97040343373795], "12": [80.80258697319596, -30.840522405116605], "13": [80.80258697347153, -20.210662097774172], "14": [82.95258696691782, -20.210662097838497], "15": [82.95258697012652, 12.189337902235595], "16": [86.9425869837806, 12.189337901839485], "17": [86.94258698791882, 160.33425638436754], "18": [83.8875054746227, 163.38933789763624], "19": [-87.63162824147732, 163.38933790219284], "20": [-90.79741302573213, 159.91263974521002], "21": [-90.79741303459365, -153.3106620978017], "22": [-16.497585998247356, -153.31066210519657], "23": [-16.497585998543396, -156.41066209784265], "24": [-9.455600383066443, -156.41066209853756], "25": [-9.455600382272054, -148.36066209853755], "26": [-16.49758599774902, -148.36066209784263], "27": [-16.497585997446166, -145.26066210519656], "28": [-82.74741303436586, -145.26066209860286], "29": [-82.74741302576386, 158.78933790206304], "30": [-48.95577329750869, 158.78933790116548], "31": [-48.95577329760036, 155.33933790116546], "32": [-17.164491784778118, 155.33933790032086], "33": [-17.16449178468646, 158.78933790032085], "34": [12.100322166570784, 158.78933789954345], "35": [12.100322166479119, 155.33933789954347], "36": [40.73771886927008, 155.33933789878265], "37": [40.73771886936174, 158.78933789878266], "38": [70.00253282061907, 158.78933789800524], "39": [70.00253282052738, 155.33933789800523], "40": [78.89258698777924, 155.33933789776916], "41": [78.89258698378052, 12.189337902064347], "42": [74.90258697012649, 12.189337903032824], "43": [74.9025869669178, -20.21066209704128], "44": [72.75258697347154, -20.210662097565475], "45": [72.75258697315665, -32.35474627638187], "46": [75.72913875214336, -39.98685200817273], "47": [88.61830240168388, -49.88754290786733], "48": [78.89258698405263, 21.930530926359797], "49": [-48.93473219331105, -145.26066210196817], "74": [78.89258698481814, 49.33486959856796], "79": [-82.74741303244902, -77.50688335166791], "86": [50.55816348933427, -79.66293350820301], "97": [74.90258697057419, 16.710181120978234], "100": [36.645602269150686, 49.334869598567934], "102": [36.645602269150686, 155.3393378988914], "103": [-44.3543977308493, -77.50688335166797], "104": [-44.3543977308493, -139.26983331688515], "111": [-44.3543977308493, 155.33933790104322], "113": [9.843781874755678, -149.46307613873103], "114": [58.542682015941665, -85.76755887436232], "116": [45.67285158508462, -75.92848041538761], "117": [74.85869862509719, -37.75497714891146], "118": [-82.747413029203, 37.22771178744709], "120": [-44.354397730849314, 37.227711787447085], "122": [-82.74741302874469, 53.427711787447095], "123": [-44.35439773084931, 53.427711787447095], "125": [-28.1543977308493, 155.3393379006128], "126": [20.44560226915069, 155.33933789932175], "128": [-82.74741303103937, -27.681360724467016], "130": [-44.354397730849314, -27.681360724467027], "132": [-82.74741303058106, -11.481360724467015], "133": [-44.3543977308493, -11.481360724467006], "134": [65.4061326048098, -0.23669348016467495], "136": [34.36376438103885, -117.39227033976987], "137": [-4.758737244378969, -87.48085926907525], "138": [55.65677411513104, -62.87005182873497], "139": [29.403789345738033, -42.798129362657164], "140": [64.58827263008406, -1.3064099209419753], "141": [36.645602269150686, -1.3064099209419657], "142": [-82.7474130273705, 102.00037694897969], "143": [-44.354397730849314, 102.00037694897968], "144": [53.74174981888012, -10.965398505887947], "145": [55.92639002626191, -12.635682064989226], "146": [72.75258697333437, -25.500281017224594], "147": [-28.15439773084927, 113.52560878814745], "148": [-44.3543977308493, 113.52560878814745], "149": [20.445602269150754, 113.52560878814747], "150": [36.645602269150686, 113.52560878814745], "151": [78.89258698661122, 113.52560878814745]}, "pivot_cargo": {"0": {}, "1": {}, "2": {}, "3": {}, "4": {}, "5": {}, "6": {}, "7": {}, "8": {}, "9": {}, "10": {}, "11": {}, "12": {}, "13": {}, "14": {}, "15": {}, "16": {}, "17": {}, "18": {}, "19": {}, "20": {}, "21": {}, "22": {}, "23": {}, "24": {}, "25": {}, "26": {}, "27": {}, "28": {}, "29": {}, "30": {}, "31": {}, "32": {}, "33": {}, "34": {}, "35": {}, "36": {}, "37": {}, "38": {}, "39": {}, "40": {}, "41": {}, "42": {}, "43": {}, "44": {}, "45": {}, "46": {}, "47": {}, "48": {}, "49": {}, "74": {}, "79": {}, "86": {}, "97": {}, "100": {}, "102": {}, "103": {}, "104": {}, "111": {}, "113": {}, "114": {}, "116": {}, "117": {}, "118": {}, "120": {}, "122": {}, "123": {}, "125": {}, "126": {}, "128": {}, "130": {}, "132": {}, "133": {}, "134": {}, "136": {}, "137": {}, "138": {}, "139": {}, "140": {}, "141": {}, "142": {}, "143": {}, "144": {}, "145": {}, "146": {}, "147": {}, "148": {}, "149": {}, "150": {}, "151": {}}, "edge_cargo": {"(0,1)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(1,2)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(4,5)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(5,6)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(6,7)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(7,8)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(8,9)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(9,10)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(10,11)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(11,12)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(12,13)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(13,14)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(14,15)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(15,16)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(16,17)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(17,18)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(18,19)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(19,20)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(20,21)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(21,22)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(22,23)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(23,24)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(24,25)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(25,26)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(26,27)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(30,31)": {"width": 5.5464329135333195, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(32,33)": {"width": 4.206437687137473, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(34,35)": {"width": 5.546432913492509, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(36,37)": {"width": 4.206437687193301, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(37,38)": {"width": 1.9, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(38,39)": {"width": 5.546432913436604, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(39,40)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(41,42)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(42,43)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(43,44)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(47,0)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(24,5)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(5,4)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(2,1)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(1,0)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(0,47)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(44,43)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(43,42)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(42,41)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(40,39)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(39,38)": {"width": -0.04643291343660394, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(38,37)": {"width": 3.6, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(37,36)": {"width": 1.2935623128066993, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(35,34)": {"width": -0.04643291349250944, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(33,32)": {"width": 1.2935623128625267, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(31,30)": {"width": -0.046432913533319464, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(27,26)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(26,25)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(25,24)": {"width": 0, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(48,41)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(41,48)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(27,49)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(49,27)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(74,48)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(48,74)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(48,97)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(97,48)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(97,42)": {"width": 2.75, "is_fixed": false, "is_starting": false, "moving_times": 0}, "(42,97)": {"width": 2.75, "is_fixed": false, "is_starting": false, "moving_times": 0}, "(79,28)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(28,79)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(46,47)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(47,46)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(49,104)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(104,49)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(103,104)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(104,103)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(31,111)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(111,31)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(2,113)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(113,3)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(3,113)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(113,2)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(86,114)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(114,86)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(86,116)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(116,86)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(45,117)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(117,46)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(46,117)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(117,45)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(118,122)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(122,118)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(123,120)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(120,123)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(111,125)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(125,111)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(35,126)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(126,102)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(102,126)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(126,35)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(128,132)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(132,128)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(133,130)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(130,133)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(42,134)": {"width": 2.75, "is_fixed": true, "is_starting": true, "moving_times": 0}, "(134,42)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(3,4)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(4,3)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(49,28)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(28,49)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(79,128)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(128,79)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(132,118)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(118,132)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(29,30)": {"width": 1.9, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(30,29)": {"width": 3.6, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(125,32)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(32,125)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(33,34)": {"width": 1.9, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(34,33)": {"width": 3.6, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(102,36)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(36,102)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(100,74)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(74,100)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(103,79)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(79,103)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(118,120)": {"width": 2.75, "is_fixed": true, "is_starting": true, "moving_times": 0}, "(120,118)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(123,122)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(122,123)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(103,130)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(130,103)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(130,128)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(128,130)": {"width": 2.75, "is_fixed": true, "is_starting": true, "moving_times": 0}, "(133,132)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(132,133)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(133,120)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(120,133)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(136,113)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(113,136)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(104,137)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(137,104)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(136,137)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(137,136)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(138,116)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(116,138)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(138,139)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(139,138)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(134,140)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(140,134)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(140,141)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(141,140)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(29,142)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(142,29)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(142,143)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(143,142)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(140,145)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(145,140)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(144,145)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(145,144)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(44,146)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(146,44)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(145,146)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(146,145)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(148,143)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(143,148)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(147,148)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(148,147)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(149,147)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(147,149)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(100,150)": {"width": 2.75, "is_fixed": true, "is_starting": true, "moving_times": 0}, "(150,100)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(150,149)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(149,150)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(74,151)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(151,74)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(151,150)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(150,151)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(122,142)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(142,122)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(40,151)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(151,40)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(146,45)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(45,146)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(117,138)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(138,117)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(114,136)": {"width": 2.75, "is_fixed": true, "is_starting": true, "moving_times": 0}, "(136,114)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(139,137)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(137,139)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(100,141)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(141,100)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(148,111)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(111,148)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(123,143)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(143,123)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(144,139)": {"width": 2.75, "is_fixed": false, "is_starting": false, "moving_times": 0}, "(139,144)": {"width": 2.75, "is_fixed": false, "is_starting": false, "moving_times": 0}, "(147,125)": {"width": 2.75, "is_fixed": true, "is_starting": true, "moving_times": 0}, "(125,147)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(149,126)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(126,149)": {"width": 2.75, "is_fixed": true, "is_starting": true, "moving_times": 0}, "(150,102)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}, "(102,150)": {"width": 2.75, "is_fixed": true, "is_starting": false, "moving_times": 0}}, "closure": {"74": {"exterior": ["0", "1", "2", "113", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "49", "28", "79", "128", "132", "118", "122", "142", "29", "30", "31", "111", "125", "32", "33", "34", "35", "126", "102", "36", "37", "38", "39", "40", "151", "74", "48", "41", "42", "43", "44", "146", "45", "117", "46", "47", "0"], "interiors": []}, "110": {"exterior": ["41", "48", "97", "42", "41"], "interiors": []}, "131": {"exterior": ["103", "79", "28", "49", "104", "103"], "interiors": []}, "163": {"exterior": ["0", "47", "46", "117", "138", "116", "86", "114", "136", "113", "2", "1", "0"], "interiors": []}, "175": {"exterior": ["118", "120", "123", "122", "118"], "interiors": []}, "188": {"exterior": ["103", "130", "128", "79", "103"], "interiors": []}, "193": {"exterior": ["128", "130", "133", "132", "128"], "interiors": []}, "194": {"exterior": ["133", "120", "118", "132", "133"], "interiors": []}, "202": {"exterior": ["104", "49", "27", "26", "25", "24", "5", "4", "3", "113", "136", "137", "104"], "interiors": []}, "205": {"exterior": ["114", "86", "116", "138", "139", "137", "136", "114"], "interiors": []}, "209": {"exterior": ["100", "141", "140", "134", "42", "97", "48", "74", "100"], "interiors": []}, "211": {"exterior": ["148", "111", "31", "30", "29", "142", "143", "148"], "interiors": []}, "212": {"exterior": ["123", "143", "142", "122", "123"], "interiors": []}, "217": {"exterior": ["134", "140", "145", "146", "44", "43", "42", "134"], "interiors": []}, "218": {"exterior": ["117", "45", "146", "145", "144", "139", "138", "117"], "interiors": []}, "221": {"exterior": ["148", "147", "125", "111", "148"], "interiors": []}, "224": {"exterior": ["147", "149", "126", "35", "34", "33", "32", "125", "147"], "interiors": []}, "226": {"exterior": ["100", "150", "149", "147", "148", "143", "123", "120", "133", "130", "103", "104", "137", "139", "144", "145", "140", "141", "100"], "interiors": []}, "227": {"exterior": ["150", "102", "126", "149", "150"], "interiors": []}, "229": {"exterior": ["100", "74", "151", "150", "100"], "interiors": []}, "230": {"exterior": ["150", "151", "40", "39", "38", "37", "36", "102", "150"], "interiors": []}}, "closure_cargo": {"74": {"angle": 0, "region_type": "surrounding", "clamp": false, "seen7fe6c6a8-af80-40": true}, "110": {"angle": 52.60000000042842, "region_type": "core", "clamp": false, "seen7fe6c6a8-af80-40": true}, "131": {"angle": 90, "region_type": "building", "clamp": false, "seen7fe6c6a8-af80-40": true}, "163": {"angle": 52.60000000042842, "region_type": "core", "clamp": false, "seen7fe6c6a8-af80-40": true}, "175": {"angle": 0.0, "region_type": "core", "clamp": true, "seen7fe6c6a8-af80-40": false}, "188": {"angle": 90, "region_type": "building", "clamp": false, "seen7fe6c6a8-af80-40": false}, "193": {"angle": 0.0, "region_type": "core", "clamp": true, "seen7fe6c6a8-af80-40": false}, "194": {"angle": 90, "region_type": "building", "clamp": false, "seen7fe6c6a8-af80-40": false}, "202": {"angle": 52.60000000042842, "region_type": "building", "clamp": false, "seen7fe6c6a8-af80-40": false}, "205": {"angle": 52.60000000042842, "region_type": "building", "clamp": false, "seen7fe6c6a8-af80-40": false}, "209": {"angle": 90, "region_type": "building", "clamp": false, "seen7fe6c6a8-af80-40": false}, "211": {"angle": 90, "region_type": "building", "clamp": false, "seen7fe6c6a8-af80-40": false}, "212": {"angle": 90, "region_type": "building", "clamp": false, "seen7fe6c6a8-af80-40": false}, "217": {"angle": 52.60000000042842, "region_type": "core", "clamp": false, "seen7fe6c6a8-af80-40": false}, "218": {"angle": 52.60000000042842, "region_type": "building", "clamp": false, "seen7fe6c6a8-af80-40": false}, "221": {"angle": 90, "region_type": "core", "clamp": true, "seen7fe6c6a8-af80-40": false}, "224": {"angle": 90, "region_type": "building", "clamp": false, "seen7fe6c6a8-af80-40": false}, "226": {"angle": 90, "region_type": "core", "clamp": false, "seen7fe6c6a8-af80-40": false}, "227": {"angle": 90, "region_type": "core", "clamp": true, "seen7fe6c6a8-af80-40": false}, "229": {"angle": 90, "region_type": "building", "clamp": false, "seen7fe6c6a8-af80-40": false}, "230": {"angle": 90, "region_type": "building", "clamp": false, "seen7fe6c6a8-af80-40": false}}}'
    return Stretch.loads(json_str)


@pytest.skip("TODO fix split bug")
def test_split_with_cuttings_overlapping_some_edges(stretch_case6):
    stretch = stretch_case6
    dividing_lines = loads(
        'MULTILINESTRING ((86.95302365965148 -48.60837456653877, 34.363739605407915 -117.39230274494993), (99.81966157695247 -58.451628661210414, 26.185677510466494 -154.7608818218978))')

    stretch.split(dividing_lines)
    assert all([closure.shape.is_valid for closure in stretch.closures])
    assert len(stretch.closures) == 23
