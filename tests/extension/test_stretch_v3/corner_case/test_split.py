import pytest

from shapely.extension.model.stretch.stretch_v3 import Stretch
from shapely.wkt import loads


@pytest.fixture
def stretch_case0() -> Stretch:
    json_str = '{"pivot": {"0": [198.94880364903648, -43.205590197861916], "1": [196.86548450431775, -37.77788406986883], "2": [198.95140896572138, -37.77788406986883], "3": [198.95140896572138, 20.903957797711342], "4": [122.75137806015061, 20.903957797711342], "5": [122.75137806015061, 59.61924704999515], "6": [88.58193615218005, 69.58029003574609], "7": [70.1395328902342, 70.55395780186495], "8": [-97.24859261027132, 70.55395711919181], "9": [-181.41369182587104, 67.903950062969], "10": [-206.74859359656992, 60.74827907859783], "11": [-206.74859266392338, 51.00046268434173], "12": [-198.6985926639234, 51.00046345454521], "13": [-198.69859301377306, 54.65701639439406], "14": [-195.9365333860862, 55.437141382185935], "15": [-196.87427624899314, 58.75725257355698], "16": [-180.70567984945737, 63.32396284393671], "17": [-160.75185815641058, 63.95222525648472], "18": [-160.64328588542975, 60.50393407649797], "19": [-97.12189356673, 62.50395711970841], "20": [69.9271806649952, 62.50395780099879], "21": [87.22525281714282, 61.59070506320086], "22": [118.15137806015062, 52.57515064595245], "23": [118.15137806015062, 36.339958898731055], "24": [114.70137806015062, 36.339958898731055], "25": [114.70137806015062, 12.853957797711342], "26": [190.90140896572137, 12.853957797711338], "27": [190.90140896572137, -37.671805252699585], "28": [190.69605324584532, -37.7506270408743], "29": [193.58069556177898, -45.266033796940526], "30": [-214.0534798549007, 37.15322502172427], "31": [-206.74873163480848, 37.154005835362796], "32": [-206.74959210933338, 45.2040057893742], "33": [-217.28569200346953, 45.20287957252916], "34": [-235.14859561942822, 28.103957848986127], "35": [-235.14859253839165, -4.096042406857038], "36": [-225.4247969677064, -33.39604123342747], "37": [-209.5252148473475, -53.74258001327212], "38": [-169.63605071658026, -66.24604269114805], "39": [-147.28661973521434, -66.24604055299395], "40": [-120.73683599393834, -39.69626188496757], "41": [-114.24858830112599, -28.07889647763149], "42": [-114.24859485690388, 16.953957975117405], "43": [23.851374294463437, 17.055199587461942], "44": [23.851374294463426, -29.54940223209325], "45": [48.86703103505623, -49.896042202258684], "46": [110.17989051976082, -49.896042202243905], "47": [111.1642512145192, -52.46061354446711], "48": [118.67965797061336, -49.57597122860645], "49": [115.71267546498024, -41.84604220224258], "50": [51.72744485162612, -41.84604220225795], "51": [31.901374294463427, -25.72038442589826], "52": [31.901374294463427, 25.11110323626781], "53": [-122.29859602794536, 24.998058651858955], "54": [-122.29858860619933, -25.983291769147094], "55": [-127.21975701439784, -34.79476357723085], "56": [-150.6210387807825, -58.19604087199539], "57": [-168.40395000269484, -58.19604257327383], "58": [-192.18510764506738, -50.741716981354564], "59": [-193.2170205469389, -54.03377648308765], "60": [-206.78257316067373, -49.781584578231346], "61": [-216.43930580550213, -37.42395883969574], "62": [-213.72087120107545, -35.29966759284297], "63": [-218.22356659275957, -29.537612608662315], "64": [-227.09859266286676, -2.795148562639799], "65": [-227.09859529047299, 24.666038587590954], "66": [116.71957145785933, -66.93398206558612], "67": [121.6242213188176, -64.36362481329365], "68": [124.47503387072868, -71.79089432017207], "69": [155.23685407285973, -59.9835695607411], "70": [157.24356177071303, -65.21167860828763], "71": [164.43221176292212, -62.45245550372266], "72": [167.1556007815921, -69.54774635419835], "73": [192.08247779650395, -59.98005074257287], "74": [189.35908877743213, -52.88475989224713], "75": [195.05399332806633, -50.69888184401236], "76": [193.04728563015442, -45.47077279649784]}, "pivot_cargo": {"0": {}, "1": {}, "2": {}, "3": {}, "4": {}, "5": {}, "6": {}, "7": {}, "8": {}, "9": {}, "10": {}, "11": {}, "12": {}, "13": {}, "14": {}, "15": {}, "16": {}, "17": {}, "18": {}, "19": {}, "20": {}, "21": {}, "22": {}, "23": {}, "24": {}, "25": {}, "26": {}, "27": {}, "28": {}, "29": {}, "30": {}, "31": {}, "32": {}, "33": {}, "34": {}, "35": {}, "36": {}, "37": {}, "38": {}, "39": {}, "40": {}, "41": {}, "42": {}, "43": {}, "44": {}, "45": {}, "46": {}, "47": {}, "48": {}, "49": {}, "50": {}, "51": {}, "52": {}, "53": {}, "54": {}, "55": {}, "56": {}, "57": {}, "58": {}, "59": {}, "60": {}, "61": {}, "62": {}, "63": {}, "64": {}, "65": {}, "66": {}, "67": {}, "68": {}, "69": {}, "70": {}, "71": {}, "72": {}, "73": {}, "74": {}, "75": {}, "76": {}}, "edge_cargo": {"(0,1)": {"width": 0, "is_fixed": true, "is_starting": false}, "(1,2)": {"width": 0, "is_fixed": true, "is_starting": false}, "(2,3)": {"width": 0, "is_fixed": true, "is_starting": false}, "(3,4)": {"width": 0, "is_fixed": true, "is_starting": false}, "(4,5)": {"width": 0, "is_fixed": true, "is_starting": false}, "(5,6)": {"width": 0, "is_fixed": true, "is_starting": false}, "(6,7)": {"width": 0, "is_fixed": true, "is_starting": false}, "(7,8)": {"width": 0, "is_fixed": true, "is_starting": false}, "(8,9)": {"width": 0, "is_fixed": true, "is_starting": false}, "(9,10)": {"width": 0, "is_fixed": true, "is_starting": false}, "(10,11)": {"width": 0, "is_fixed": true, "is_starting": false}, "(11,12)": {"width": 0, "is_fixed": true, "is_starting": false}, "(12,13)": {"width": 0, "is_fixed": true, "is_starting": false}, "(13,14)": {"width": 0, "is_fixed": true, "is_starting": false}, "(14,15)": {"width": 0, "is_fixed": true, "is_starting": false}, "(15,16)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(16,17)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(17,18)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(18,19)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(19,20)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(20,21)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(21,22)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(22,23)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(23,24)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(24,25)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(25,26)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(26,27)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(27,28)": {"width": 0, "is_fixed": true, "is_starting": false}, "(28,29)": {"width": 0, "is_fixed": true, "is_starting": false}, "(29,0)": {"width": 0, "is_fixed": true, "is_starting": false}, "(30,31)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(31,32)": {"width": 0, "is_fixed": true, "is_starting": false}, "(32,33)": {"width": 0, "is_fixed": true, "is_starting": false}, "(33,34)": {"width": 0, "is_fixed": true, "is_starting": false}, "(34,35)": {"width": 0, "is_fixed": true, "is_starting": false}, "(35,36)": {"width": 0, "is_fixed": true, "is_starting": false}, "(36,37)": {"width": 0, "is_fixed": true, "is_starting": false}, "(37,38)": {"width": 0, "is_fixed": true, "is_starting": false}, "(38,39)": {"width": 0, "is_fixed": true, "is_starting": false}, "(39,40)": {"width": 0, "is_fixed": true, "is_starting": false}, "(40,41)": {"width": 0, "is_fixed": true, "is_starting": false}, "(41,42)": {"width": 0, "is_fixed": true, "is_starting": false}, "(42,43)": {"width": 0, "is_fixed": true, "is_starting": false}, "(43,44)": {"width": 0, "is_fixed": true, "is_starting": false}, "(44,45)": {"width": 0, "is_fixed": true, "is_starting": false}, "(45,46)": {"width": 0, "is_fixed": true, "is_starting": false}, "(46,47)": {"width": 0, "is_fixed": true, "is_starting": false}, "(47,48)": {"width": 0, "is_fixed": true, "is_starting": false}, "(48,49)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(49,50)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(50,51)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(51,52)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(52,53)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(53,54)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(54,55)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(55,56)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(56,57)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(57,58)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(58,59)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(59,60)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(60,61)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(61,62)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(62,63)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(63,64)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(64,65)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(65,30)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(31,30)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(30,65)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(65,64)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(64,63)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(63,62)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(62,61)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(61,60)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(60,59)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(59,58)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(58,57)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(57,56)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(56,55)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(55,54)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(54,53)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(53,52)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(52,51)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(51,50)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(50,49)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(49,48)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(48,47)": {"width": 0, "is_fixed": true, "is_starting": false}, "(47,66)": {"width": 0, "is_fixed": true, "is_starting": false}, "(66,67)": {"width": 0, "is_fixed": true, "is_starting": false}, "(67,68)": {"width": 0, "is_fixed": true, "is_starting": false}, "(68,69)": {"width": 0, "is_fixed": true, "is_starting": false}, "(69,70)": {"width": 0, "is_fixed": true, "is_starting": false}, "(70,71)": {"width": 0, "is_fixed": true, "is_starting": false}, "(71,72)": {"width": 0, "is_fixed": true, "is_starting": false}, "(72,73)": {"width": 0, "is_fixed": true, "is_starting": false}, "(73,74)": {"width": 0, "is_fixed": true, "is_starting": false}, "(74,75)": {"width": 0, "is_fixed": true, "is_starting": false}, "(75,76)": {"width": 0, "is_fixed": true, "is_starting": false}, "(76,29)": {"width": 0, "is_fixed": true, "is_starting": false}, "(29,28)": {"width": 0, "is_fixed": true, "is_starting": false}, "(28,27)": {"width": 0, "is_fixed": true, "is_starting": false}, "(27,26)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(26,25)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(25,24)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(24,23)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(23,22)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(22,21)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(21,20)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(20,19)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(19,18)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(18,17)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(17,16)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(16,15)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(15,14)": {"width": 0, "is_fixed": true, "is_starting": false}, "(14,13)": {"width": 0, "is_fixed": true, "is_starting": false}, "(13,12)": {"width": 0, "is_fixed": true, "is_starting": false}, "(12,11)": {"width": 0, "is_fixed": true, "is_starting": false}, "(11,32)": {"width": 0, "is_fixed": true, "is_starting": false}, "(32,31)": {"width": 0, "is_fixed": true, "is_starting": false}}, "closure": {"0": {"exterior": ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "0"], "interiors": []}, "1": {"exterior": ["30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63", "64", "65", "30"], "interiors": []}, "2": {"exterior": ["11", "32", "31", "30", "65", "64", "63", "62", "61", "60", "59", "58", "57", "56", "55", "54", "53", "52", "51", "50", "49", "48", "47", "66", "67", "68", "69", "70", "71", "72", "73", "74", "75", "76", "29", "28", "27", "26", "25", "24", "23", "22", "21", "20", "19", "18", "17", "16", "15", "14", "13", "12", "11"], "interiors": []}}, "closure_cargo": {"0": {"angle": 0, "region_type": "surrounding", "clamp": false}, "1": {"angle": 0, "region_type": "surrounding", "clamp": false}, "2": {"angle": 0, "region_type": "core", "clamp": false}}}'
    return Stretch.loads(json_str)


def test_split_case0(stretch_case0):
    stretch = stretch_case0
    dividing_lines = loads(
        'MULTILINESTRING ((-226.83179821988708 24.92142496396614, -206.74959210933338 24.936147305605047), (-206.74959210933338 24.936147305605047, -179.59500767884788 24.956054434674805), (-179.59500767884788 24.956054434674805, -118.68625408439192 25.00070687346969), (-118.68625408439192 25.00070687346969, -92.03325513318362 25.02024628831789), (-92.03325513318362 25.02024628831789, -9.247115088551368 25.080937122282748), (-9.247115088551368 25.080937122282748, 114.70137806015062 25.17180423378024), (-160.70625824840062 62.50395711970841, -183.6089386102226 62.50395711970841), (96.87193906218116 58.77851232631966, 31.901374294463427 58.77851232631966), (31.901374294463427 58.77851232631966, -9.247115088551368 58.77851232631966), (-9.247115088551368 58.77851232631966, -9.248115088551367 58.77851232631966), (-122.29859029557925 -14.37862773281745, -179.59500767884788 -14.37862773281745), (-179.59500767884788 -14.37862773281745, -223.25438146972652 -14.37862773281745), (190.71185804723146 -37.79180355362928, 46.74286545535957 -37.79180355362928), (-118.68625408439192 25.00070687346969, -118.68625944518446 61.82498540490811), (-206.74959210933338 37.1540057433856, -206.74959210933338 24.936147305605047), (-92.03325513318362 62.503957140461836, -92.03325513318362 25.02024628831789), (-9.247115088551368 25.080937122282748, -9.247115088551368 58.77851232631966), (-9.247115088551368 58.77851232631966, -9.247115088551368 62.50395747809556), (31.901374294463427 62.50395764591492, 31.901374294463427 58.77851232631966), (31.901374294463427 58.77851232631966, 31.901374294463427 25.111103236268775), (-179.59500767884788 -54.68814826087275, -179.59500767884788 -14.37862773281745), (-179.59500767884788 -14.37862773281745, -179.59500767884788 24.956054434674805))')

    assert len(stretch.closures) == 3
    stretch.split(dividing_lines)
    assert len(stretch.closures) == 17
    assert len([edge for edge in stretch.edges if not edge.closure]) == 0
    assert len([pivot for pivot in stretch.pivots if pivot.dangling]) == 0


@pytest.fixture
def stretch_case1() -> Stretch:
    json_str = '{"pivot": {"0": [103.29135587861752, -10.86117029946763], "1": [104.2164140753448, -60.252402334247996], "2": [77.78092941228022, -60.747517777786385], "3": [77.93167302455309, -68.7961062480313], "4": [112.41574615786298, -68.15024719222107], "5": [111.18920073600523, -2.6618381908893127], "6": [83.7964702693467, -3.1748821694257696], "7": [83.94721390752306, -11.223470639185503], "8": [66.57881991460852, 3.70514184943133], "9": [66.75948876465053, -4.34283048940188], "10": [76.64344912520808, -4.12094556273704], "11": [76.46278027516607, 3.92702677609617], "12": [23.779004529929672, -103.8701822456652], "13": [17.086701819567324, -103.87068913160324], "14": [17.08731153971389, -111.92068910851265], "15": [25.530385746108085, -111.92004961628191], "16": [58.31065180542609, -96.95055110143535], "17": [63.510228051784395, -88.30178630168962], "18": [56.61104364096414, -84.15404541471331], "19": [52.697059444232394, -90.66440840269006], "20": [39.27233687183024, 37.56162193469432], "21": [39.27233687209568, 9.343560637945332], "22": [57.18975619510687, -0.5444931868081317], "23": [61.079307144448535, 6.503477685185839], "24": [47.32233687205095, 14.095512010368978], "25": [47.322336871812716, 39.4272418341736], "26": [40.62323832986297, 53.10400634287504], "27": [40.62184192935729, 71.54051200844998], "28": [-149.72668220357988, 71.52609480921343], "29": [-187.25003154221795, 52.91577377252135], "30": [-180.05204087747916, 38.40271310188086], "31": [-165.74044506751895, 45.50078396254934], "32": [-152.57822331171604, 37.90290287980959], "33": [-148.55375215562668, 44.874712681705006], "34": [-165.45230823573002, 54.62938950583339], "35": [-176.4170832485691, 49.19122935831547], "36": [-176.4615152850747, 49.280816143739216], "37": [-147.83977570915494, 63.47623770242358], "38": [32.57245166798918, 63.48990231599737], "39": [32.573379632653705, 51.2380979620812], "40": [-4.457600210324653, -103.55975052753173], "41": [-14.527663127412048, -87.16122637589929], "42": [-14.527663127412048, -68.63545624687329], "43": [-22.57766312741206, -68.63545624687329], "44": [-22.57766312741206, -89.43561132479618], "45": [-8.96068091158169, -111.61009162121417], "46": [3.986522176393011, -111.60911097917918], "47": [3.985912456416801, -103.55911100226974], "48": [-31.36454225994058, -51.65841270612208], "49": [-36.568599980431344, -47.63231583358551], "50": [-62.25043455810138, -42.09125887818172], "51": [-63.94821747763037, -49.9601872142486], "52": [-40.05067905260113, -55.11626829975534], "53": [-36.2903552200723, -58.025426659444186], "54": [-92.50095529992754, -35.56416209603301], "55": [-135.63691749788273, 15.722636640510537], "56": [-135.63699899554243, 17.861678084134752], "57": [-143.6869989896996, 17.861371378454947], "58": [-143.6868056659223, 12.787267738825136], "59": [-96.88967773931701, -42.852499154652435], "60": [-76.91319285276722, -47.16258222920314], "61": [-75.21540993306982, -39.29365389317263], "62": [17.087131229702802, -109.54009599008222], "63": [68.66781911141652, -79.72285796319835], "64": [69.35314769363185, -80.13487266220915], "65": [70.95041473354604, -77.47804327919204], "66": [71.97858620714305, -78.09617269941538], "67": [77.56559845234779, -68.80296253141313], "68": [76.6252261191497, -3.3091938487361756], "69": [66.16672996492207, 3.6958908462979707], "70": [-150.9358355583563, 36.954835974898685], "71": [-152.1584552511522, 34.836825526413634], "72": [-146.74558853854433, 31.712252925910775], "73": [-147.04555957025195, 31.192641794826557], "74": [-143.68743305614407, 29.254166184732526], "75": [-76.2931652081123, -44.288862011180825], "76": [-63.67242677450213, -44.98903870474237], "77": [-63.941733893284464, -49.843827395784366], "78": [-63.923666045693565, -49.846262364418315], "79": [-34.899528097428785, -56.22766946317961], "80": [-34.56350988585791, -56.30016802408795], "81": [-35.854883607853935, -57.96937189175816], "82": [-33.60064705791592, -59.71335409796933], "83": [-33.05008592016793, -59.00170978440843], "84": [-22.688862302703, -67.01763424981726], "85": [-23.239423426459783, -67.72927855697486], "86": [-22.577663127412052, -68.2412471011267], "87": [3.9863655410217524, -109.54108830612387], "88": [-147.8398428485195, 63.47620440355365], "90": [-183.67325222796114, 45.70403682937753], "91": [-147.83991931275324, 63.476166479861796]}, "pivot_cargo": {"0": {}, "1": {}, "2": {}, "3": {}, "4": {}, "5": {}, "6": {}, "7": {}, "8": {}, "9": {}, "10": {}, "11": {}, "12": {}, "13": {}, "14": {}, "15": {}, "16": {}, "17": {}, "18": {}, "19": {}, "20": {}, "21": {}, "22": {}, "23": {}, "24": {}, "25": {}, "26": {}, "27": {}, "28": {}, "29": {}, "30": {}, "31": {}, "32": {}, "33": {}, "34": {}, "35": {}, "36": {}, "37": {}, "38": {}, "39": {}, "40": {}, "41": {}, "42": {}, "43": {}, "44": {}, "45": {}, "46": {}, "47": {}, "48": {}, "49": {}, "50": {}, "51": {}, "52": {}, "53": {}, "54": {}, "55": {}, "56": {}, "57": {}, "58": {}, "59": {}, "60": {}, "61": {}, "62": {}, "63": {}, "64": {}, "65": {}, "66": {}, "67": {}, "68": {}, "69": {}, "70": {}, "71": {}, "72": {}, "73": {}, "74": {}, "75": {}, "76": {}, "77": {}, "78": {}, "79": {}, "80": {}, "81": {}, "82": {}, "83": {}, "84": {}, "85": {}, "86": {}, "87": {}, "88": {}, "90": {}, "91": {}}, "edge_cargo": {"(0,1)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(1,2)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(2,3)": {"width": 0, "is_fixed": true, "is_starting": false}, "(3,4)": {"width": 0, "is_fixed": true, "is_starting": false}, "(4,5)": {"width": 0, "is_fixed": true, "is_starting": false}, "(5,6)": {"width": 0, "is_fixed": true, "is_starting": false}, "(6,7)": {"width": 0, "is_fixed": true, "is_starting": false}, "(7,0)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(8,9)": {"width": 0, "is_fixed": true, "is_starting": false}, "(9,10)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(11,8)": {"width": 0, "is_fixed": true, "is_starting": false}, "(12,13)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(14,15)": {"width": 0, "is_fixed": true, "is_starting": false}, "(15,16)": {"width": 0, "is_fixed": true, "is_starting": false}, "(16,17)": {"width": 0, "is_fixed": true, "is_starting": false}, "(17,18)": {"width": 0, "is_fixed": true, "is_starting": false}, "(18,19)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(19,12)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(20,21)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(21,22)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(22,23)": {"width": 0, "is_fixed": true, "is_starting": false}, "(23,24)": {"width": 0, "is_fixed": true, "is_starting": false}, "(24,25)": {"width": 0, "is_fixed": true, "is_starting": false}, "(25,26)": {"width": 0, "is_fixed": true, "is_starting": false}, "(26,27)": {"width": 0, "is_fixed": true, "is_starting": false}, "(27,28)": {"width": 0, "is_fixed": true, "is_starting": false}, "(28,29)": {"width": 0, "is_fixed": true, "is_starting": false}, "(30,31)": {"width": 0, "is_fixed": true, "is_starting": false}, "(31,32)": {"width": 0, "is_fixed": true, "is_starting": false}, "(32,33)": {"width": 0, "is_fixed": true, "is_starting": false}, "(33,34)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(34,35)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(35,36)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(37,38)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(38,39)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(39,20)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(40,41)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(41,42)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(42,43)": {"width": 0, "is_fixed": true, "is_starting": false}, "(43,44)": {"width": 0, "is_fixed": true, "is_starting": false}, "(44,45)": {"width": 0, "is_fixed": true, "is_starting": false}, "(45,46)": {"width": 0, "is_fixed": true, "is_starting": false}, "(47,40)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(48,49)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(49,50)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(51,52)": {"width": 0, "is_fixed": true, "is_starting": false}, "(52,53)": {"width": 0, "is_fixed": true, "is_starting": false}, "(54,55)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(55,56)": {"width": 0, "is_fixed": true, "is_starting": false}, "(56,57)": {"width": 0, "is_fixed": true, "is_starting": false}, "(57,58)": {"width": 0, "is_fixed": true, "is_starting": false}, "(58,59)": {"width": 0, "is_fixed": true, "is_starting": false}, "(59,60)": {"width": 0, "is_fixed": true, "is_starting": false}, "(61,54)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(13,62)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(62,14)": {"width": 0, "is_fixed": true, "is_starting": false}, "(10,68)": {"width": 0, "is_fixed": true, "is_starting": false}, "(68,11)": {"width": 0, "is_fixed": true, "is_starting": false}, "(60,75)": {"width": 0, "is_fixed": true, "is_starting": false}, "(75,61)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(50,78)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(78,51)": {"width": 0, "is_fixed": true, "is_starting": false}, "(53,79)": {"width": 0, "is_fixed": true, "is_starting": false}, "(79,48)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(46,87)": {"width": 0, "is_fixed": true, "is_starting": false}, "(87,47)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(62,13)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(13,12)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(12,19)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(19,18)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(18,17)": {"width": 0, "is_fixed": true, "is_starting": false}, "(17,63)": {"width": 0, "is_fixed": true, "is_starting": false}, "(63,64)": {"width": 0, "is_fixed": true, "is_starting": false}, "(64,65)": {"width": 0, "is_fixed": true, "is_starting": false}, "(65,66)": {"width": 0, "is_fixed": true, "is_starting": false}, "(66,67)": {"width": 0, "is_fixed": true, "is_starting": false}, "(67,3)": {"width": 0, "is_fixed": true, "is_starting": false}, "(3,2)": {"width": 0, "is_fixed": true, "is_starting": false}, "(2,1)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(1,0)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(0,7)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(7,6)": {"width": 0, "is_fixed": true, "is_starting": false}, "(6,68)": {"width": 0, "is_fixed": true, "is_starting": false}, "(68,10)": {"width": 0, "is_fixed": true, "is_starting": false}, "(10,9)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(9,8)": {"width": 0, "is_fixed": true, "is_starting": false}, "(8,69)": {"width": 0, "is_fixed": true, "is_starting": false}, "(69,23)": {"width": 0, "is_fixed": true, "is_starting": false}, "(23,22)": {"width": 0, "is_fixed": true, "is_starting": false}, "(22,21)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(21,20)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(20,39)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(39,38)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(38,37)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(36,35)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(35,34)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(34,33)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(33,32)": {"width": 0, "is_fixed": true, "is_starting": false}, "(32,70)": {"width": 0, "is_fixed": true, "is_starting": false}, "(70,71)": {"width": 0, "is_fixed": true, "is_starting": false}, "(71,72)": {"width": 0, "is_fixed": true, "is_starting": false}, "(72,73)": {"width": 0, "is_fixed": true, "is_starting": false}, "(73,74)": {"width": 0, "is_fixed": true, "is_starting": false}, "(74,57)": {"width": 0, "is_fixed": true, "is_starting": false}, "(57,56)": {"width": 0, "is_fixed": true, "is_starting": false}, "(56,55)": {"width": 0, "is_fixed": true, "is_starting": false}, "(55,54)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(54,61)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(61,75)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(75,76)": {"width": 0, "is_fixed": true, "is_starting": false}, "(76,77)": {"width": 0, "is_fixed": true, "is_starting": false}, "(77,78)": {"width": 0, "is_fixed": true, "is_starting": false}, "(78,50)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(50,49)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(49,48)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(48,79)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(79,80)": {"width": 0, "is_fixed": true, "is_starting": false}, "(80,81)": {"width": 0, "is_fixed": true, "is_starting": false}, "(81,82)": {"width": 0, "is_fixed": true, "is_starting": false}, "(82,83)": {"width": 0, "is_fixed": true, "is_starting": false}, "(83,84)": {"width": 0, "is_fixed": true, "is_starting": false}, "(84,85)": {"width": 0, "is_fixed": true, "is_starting": false}, "(85,86)": {"width": 0, "is_fixed": true, "is_starting": false}, "(86,43)": {"width": 0, "is_fixed": true, "is_starting": false}, "(43,42)": {"width": 0, "is_fixed": true, "is_starting": false}, "(42,41)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(41,40)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(40,47)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(47,87)": {"width": 2.75, "is_fixed": true, "is_starting": false}, "(87,62)": {"width": 0, "is_fixed": true, "is_starting": false}, "(88,37)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(37,88)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(29,90)": {"width": 0, "is_fixed": true, "is_starting": false}, "(90,30)": {"width": 0, "is_fixed": true, "is_starting": false}, "(36,90)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(90,36)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(36,91)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(91,88)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(88,91)": {"width": 2.75, "is_fixed": false, "is_starting": false}, "(91,36)": {"width": 2.75, "is_fixed": false, "is_starting": false}}, "closure": {"0": {"exterior": ["0", "1", "2", "3", "4", "5", "6", "7", "0"], "interiors": []}, "1": {"exterior": ["10", "68", "11", "8", "9", "10"], "interiors": []}, "2": {"exterior": ["12", "13", "62", "14", "15", "16", "17", "18", "19", "12"], "interiors": []}, "4": {"exterior": ["40", "41", "42", "43", "44", "45", "46", "87", "47", "40"], "interiors": []}, "5": {"exterior": ["48", "49", "50", "78", "51", "52", "53", "79", "48"], "interiors": []}, "6": {"exterior": ["54", "55", "56", "57", "58", "59", "60", "75", "61", "54"], "interiors": []}, "10": {"exterior": ["30", "31", "32", "33", "34", "35", "36", "90", "30"], "interiors": []}, "11": {"exterior": ["20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "90", "36", "91", "88", "37", "38", "39", "20"], "interiors": []}, "12": {"exterior": ["0", "7", "6", "68", "10", "9", "8", "69", "23", "22", "21", "20", "39", "38", "37", "88", "91", "36", "35", "34", "33", "32", "70", "71", "72", "73", "74", "57", "56", "55", "54", "61", "75", "76", "77", "78", "50", "49", "48", "79", "80", "81", "82", "83", "84", "85", "86", "43", "42", "41", "40", "47", "87", "62", "13", "12", "19", "18", "17", "63", "64", "65", "66", "67", "3", "2", "1", "0"], "interiors": []}}, "closure_cargo": {"0": {"angle": 0, "region_type": "surrounding", "clamp": false}, "1": {"angle": 0, "region_type": "surrounding", "clamp": false}, "2": {"angle": 0, "region_type": "surrounding", "clamp": false}, "4": {"angle": 0, "region_type": "surrounding", "clamp": false}, "5": {"angle": 0, "region_type": "surrounding", "clamp": false}, "6": {"angle": 0, "region_type": "surrounding", "clamp": false}, "10": {"angle": 0, "region_type": "surrounding", "clamp": false}, "11": {"angle": 0, "region_type": "surrounding", "clamp": false}, "12": {"angle": 90, "region_type": "core", "clamp": false}}}'
    return Stretch.loads(json_str)


def test_split_case1(stretch_case1):
    stretch = stretch_case1
    dividing_lines = loads(
        'MULTILINESTRING ((37.517148491518576 41.144984381986376, -8.638404439152058 41.144984381986376), (-8.638404439152058 41.144984381986376, -58.89920337977105 41.144984381986376), (-58.89920337977105 41.144984381986376, -109.15704101037772 41.144984381986376), (-109.15704101037772 41.144984381986376, -150.70673457895484 41.144984381986376), (-135.63699898385693 17.861371378454947, -109.15704101037772 17.861371378454947), (-109.15704101037772 17.861371378454947, -58.89920337977105 17.861371378454947), (-58.89920337977105 17.861371378454947, -43.68387302652263 17.861371378454947), (-43.68387302652263 17.861371378454947, -8.638404439152051 17.861371378454947), (-8.638404439152051 17.861371378454947, -2.835515942661914 17.861371378454947), (-2.835515942661914 17.861371378454947, 28.827767421728822 17.861371378454947), (28.827767421728822 17.861371378454947, 39.27233687201556 17.861371378454947), (48.262306424602684 4.382282386008728, 48.262306424602684 -21.788764952350903), (48.262306424602684 -21.788764952350903, 48.262306424602684 -29.58852625935623), (48.262306424602684 -29.58852625935623, 48.262306424602684 -36.637005864303376), (48.262306424602684 -36.637005864303376, 48.262306424602684 -57.7767575018961), (48.262306424602684 -57.7767575018961, 48.262306424602684 -78.65533639552984), (48.262306424602684 -78.65533639552984, 48.262306424602684 -92.68959113369439), (-58.89920337977105 41.144984381986376, -58.89920337977105 17.861371378454947), (-8.638404439152051 17.861371378454947, -8.638404439152058 41.144984381986376), (-109.15704101037772 41.144984381986376, -109.15704101037772 17.861371378454947), (83.94721390752306 -60.63202821057177, 83.94721390752306 -57.7767575018961), (83.94721390752306 -57.7767575018961, 83.94721390752306 -29.58852625935623), (83.94721390752306 -29.58852625935623, 83.94721390752306 -11.223470639185503), (-43.68387302652263 17.861371378454947, -43.68387302652263 -21.788764952350903), (-43.68387302652263 -21.788764952350903, -43.68387302652263 -36.637005864303376), (-43.68387302652263 -36.637005864303376, -43.68387302652263 -46.0971399456479), (-2.835515942661914 -87.41652128140854, -2.835515942661914 -78.65533639552984), (-2.835515942661914 -78.65533639552984, -2.835515942661914 -36.637005864303376), (-2.835515942661914 -36.637005864303376, -2.835515942661914 -21.788764952350903), (-2.835515942661914 -21.788764952350903, -2.835515942661914 17.861371378454947), (28.827767421728822 -101.56460460105922, 28.827767421728822 -78.65533639552984), (28.827767421728822 -78.65533639552984, 28.827767421728822 -36.637005864303376), (28.827767421728822 -36.637005864303376, 28.827767421728822 -21.788764952350903), (28.827767421728822 -21.788764952350903, 28.827767421728822 17.861371378454947), (48.262306424602684 -29.58852625935623, 83.94721390752306 -29.58852625935623), (83.94721390752306 -29.58852625935623, 103.64210424872348 -29.58852625935623), (48.262306424602684 -21.788764952350903, 28.827767421728822 -21.788764952350903), (28.827767421728822 -21.788764952350903, -2.835515942661914 -21.788764952350903), (-2.835515942661914 -21.788764952350903, -43.68387302652263 -21.788764952350903), (-43.68387302652263 -21.788764952350903, -104.0870754144648 -21.788764952350903), (48.262306424602684 -36.637005864303376, 28.827767421728822 -36.637005864303376), (28.827767421728822 -36.637005864303376, -2.835515942661914 -36.637005864303376), (-2.835515942661914 -36.637005864303376, -43.68387302652263 -36.637005864303376), (-43.68387302652263 -36.637005864303376, -51.093210775128476 -36.637005864303376), (-14.527663127412048 -78.65533639552984, -2.835515942661914 -78.65533639552984), (-2.835515942661914 -78.65533639552984, 28.827767421728822 -78.65533639552984), (28.827767421728822 -78.65533639552984, 48.262306424602684 -78.65533639552984), (104.1700472314738 -57.7767575018961, 83.94721390752306 -57.7767575018961), (83.94721390752306 -57.7767575018961, 48.262306424602684 -57.7767575018961))')

    assert len(stretch.closures) == 9

    stretch.split(dividing_lines, dist_tol_to_edge=0.01, dist_tol_to_pivot=0.01)

    assert len(stretch.closures) == 32
